<!doctype html><html><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Servo Animation</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><style type="text/css">@font-face{font-family:"Material Symbols Outlined";font-style:normal;font-weight:400;src:url(font.woff2) format("woff2")}.syms{font-family:"Material Symbols Outlined";font-weight:normal;font-style:normal;font-size:24px;line-height:1;letter-spacing:normal;text-transform:none;display:inline-block;white-space:nowrap;word-wrap:normal;direction:ltr;-webkit-font-feature-settings:"liga";-webkit-font-smoothing:antialiased}body{-webkit-touch-callout:none !important;width:auto !important}body{user-select:none;-ms-user-select:none;-moz-user-select:-moz-none;-khtml-user-select:none;-webkit-user-drag:none;-webkit-user-select:none;-webkit-app-region:no-drag;font-family:Arial,Helvetica,sans-serif;text-align:center;margin-left:auto;margin-right:auto;min-width:390px;width:390px}html,body{-webkit-user-drag:none;overflow-x:hidden}.tg{border-collapse:collapse;border-color:#000;border-spacing:0;border-style:solid;border-width:1px;margin-top:38px}.tg td{border-style:solid;border-width:0px;font-family:Arial,sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;word-break:normal}.tg th{border-style:solid;border-width:0px;font-family:Arial,sans-serif;font-size:14px;font-weight:normal;overflow:hidden;padding:10px 5px;word-break:normal}.tg .tg-center{border-color:inherit;text-align:center;vertical-align:top}.tg .tg-left{border-color:inherit;text-align:left;vertical-align:top}.nam0_css{width:50px}.pos0_css{width:100px}.dur0_css{width:50px}.eas0_css{width:80px}.min0_css{width:50px}.max0_css{width:50px}.err0_css{width:50px}.seqnam0_css{width:270px}.seqdur0_css{width:80px}.setnam0_css{width:70px}.serial0_css{width:90px}.navbar{position:fixed;top:0;background-color:#1b1a65}#script_editor{position:absolute;margin-top:50px;top:0;right:0;bottom:0;left:0;z-index:0;isolation:isolate}.navbar a{float:left;font-size:16px;color:#fff;text-align:center;padding:10px 14px;text-decoration:none}#box{position:absolute;width:50px;height:50px;background:red}.navbar-right{float:right}.navbar #navbarinfo{float:right;font-size:16px;color:#fff;text-align:center;padding:10px 14px;text-decoration:none}.dropdown{float:left;overflow:hidden}.dropdown .dropbtn{font-size:16px;border:none;outline:none;color:#fff;padding:10px 14px;background-color:inherit;font-family:inherit;margin:0}.dropbtn span{pointer-events:none}@media(hover: hover)and (pointer: fine){.navbar a:hover,.dropdown:hover,.dropbtn{background-color:red}}.navbar a:active{background-color:red}.dropdown-content{display:none;position:absolute;background-color:#f9f9f9;min-width:160px;box-shadow:0px 8px 16px 0px rgba(0,0,0,.2);z-index:1}.dropdown-content a{float:none;color:#000;padding:10px 14px;text-decoration:none;display:block;text-align:left}.dropdown-content a:hover{background-color:#ddd}.show{display:block}.multiselect-wrapper{width:180px;display:inline-block;white-space:nowrap;font-size:12px;font-family:"Segoe UI",Verdana,Helvetica,Sans-Serif}.multiselect-wrapper .multiselect-input{width:100%;padding-right:50px}.multiselect-wrapper label{display:block;font-size:12px;font-weight:600}.multiselect-wrapper .multiselect-list{z-index:1;position:absolute;display:none;background-color:#fff;border:1px solid gray;border-bottom-left-radius:2px;border-bottom-right-radius:2px;margin-top:-2px}.multiselect-wrapper .multiselect-list.active{display:block}.multiselect-wrapper .multiselect-list>span{font-weight:bold}.multiselect-wrapper .multiselect-list .multiselect-checkbox{margin-right:2px}.multiselect-wrapper .multiselect-list>span,.multiselect-wrapper .multiselect-list li{cursor:default}.multiselect-wrapper .multiselect-list{padding:5px;min-width:200px}.multiselect-wrapper ul{list-style:none;display:block;position:relative;padding:0px;margin:0px;max-height:200px;overflow-y:auto;overflow-x:hidden}.multiselect-wrapper ul li{padding-right:20px;display:block}.multiselect-wrapper ul li.active{background-color:#06f;color:#fff}.multiselect-wrapper ul li:hover{background-color:#06f;color:#fff}.multiselect-input-div{height:34px}.multiselect-input-div input{border:1px solid #ababab;background:#fff;margin:5px 0 6px 0;padding:5px;vertical-align:middle}.multiselect-count{display:inline-block !important}.multiselect-count{position:relative;text-align:center;border-radius:2px;background-color:#add8e6;padding:2px 7px;left:-45px}.multiselect-wrapper.disabled .multiselect-dropdown-arrow{border-top:5px solid #d3d3d3}.multiselect-wrapper.disabled .multiselect-count{background-color:#d3d3d3}.multiselect-dropdown-arrow{display:inline-block !important}.multiselect-dropdown-arrow{width:0;height:0;border-left:5px solid rgba(0,0,0,0);border-right:5px solid rgba(0,0,0,0);border-top:5px solid #000;position:absolute;line-height:20px;text-align:center;margin-top:17px;margin-left:-42px}
</style></head><body><div style="position:fixed;top:250px;left:150px;z-index:10000;font-size:100px;color:grey;transform:rotate(-30deg);opacity:0.4;">BETA</div><div hidden id="script_editor"></div><div class="navbar"><div class="dropdown"><button id="dropbtn" class="dropbtn"><span class="syms">menu</span></button><div id="dropdown-content" class="dropdown-content"><a id="showAnimate" href="#">Animate</a> <a id="showTimeline" href="#">Timeline</a> <a id="showFrames" href="#">Frames</a> <a id="showSequences" href="#">Sequences</a> <a id="showSettings" href="#">Settings</a> <a id="showScript" href="#">Script</a> <a id="saveToFile" href="#">Save</a> <a id="openFile" href="#">Load</a> <a href="/">Home</a></div></div><a id="add_button" href="#" hidden><span class="syms">library_add</span></a> <a id="edit_button" href="#" hidden><span class="syms">edit_note</span></a> <a id="up_button" href="#" hidden><span class="syms">keyboard_arrow_up</span></a> <a id="down_button" href="#" hidden><span class="syms">keyboard_arrow_down</span></a> <a id="del_button" href="#" hidden><span class="syms">delete</span></a><div class="navbar-right"><a id="playSeq" href="#"><span class="syms">play_circle</span></a> <a id="stopSeq" href="#" hidden><span class="syms">stop_circle</span></a> <a id="prevFrame" href="#" hidden><span class="syms">arrow_back_ios</span></a><div id="navbarinfo"></div><a id="nextFrame" href="#" hidden><span class="syms">arrow_forward_ios</span></a> <a id="sync_script" hidden href="#" hidden><span class="syms">sync</span></a> <a id="upload_button" hidden href="#" hidden><span class="syms">publish</span></a></div></div><table hidden id="output" class="tg"><thead><tr><th class="tg-left"></th><th class="tg-left"># Name</th><th class="tg-center">Position</th><th class="tg-center">Duration</th><th class="tg-center">Easing</th></tr></thead><tbody><tr><td class="tg-left" id="col0"><input type="checkbox" id="srvena"/></td><td class="tg-left" id="col1"><input id="srvnam" class="nam0_css" value="1"/></td><td class="tg-center" id="col2"><input type="range" min="0" max="1000" class="pos0_css" id="srvpos"/></td><td class="tg-center" id="col3"><input type="number" id="srvdur" min="0" class="dur0_css" value="0"/></td><td class="tg-center" id="col4"><select id="srveas" class="eas0_css"><option value="0">Linear</option><option value="1">Continuous</option><option value="2">Quadratic Ease In</option><option value="3">Quadratic Ease Out</option><option value="4">Quadratic Ease In Out</option><option value="5">Cubic Ease In</option><option value="6">Cubic Ease Out</option><option value="7">Cubic Ease In Out</option><option value="8">Quartic Ease In</option><option value="9">Quartic Ease Out</option><option value="10">Quartic Ease In Out</option><option value="11">Quintic Ease In</option><option value="12">Quintic Ease Out</option><option value="13">Quintic Ease In Out</option><option value="14">Sine Ease In</option><option value="15">Sine Ease Out</option><option value="16">Sine Ease In Out</option><option value="17">Circular Ease In</option><option value="18">Circular Ease Out</option><option value="19">Circular Ease In Out</option><option value="20">Exponential Ease In</option><option value="21">Exponential Ease Out</option><option value="22">Exponential Ease In Out</option><option value="23">Elastic Ease In</option><option value="24">Elastic Ease Out</option><option value="25">Elastic Ease In Out</option><option value="26">Back Ease In</option><option value="27">Back Ease Out</option><option value="28">Back Ease In Out</option><option value="29">Bounce Ease In</option><option value="30">Bounce Ease Out</option><option value="31">Bounce Ease In Out</option></select></td></tr></tbody></table><table hidden id="frames" class="tg"><thead><tr><th class="tg-left" id="frselall"><input type="checkbox"/></th><th class="tg-left">Name</th><th class="tg-left">Duration</th><th class="tg-center">Serial Begin</th><th class="tg-center">Serial End</th></tr></thead><tbody><tr><td class="tg-left" id="frcol0"><input type="checkbox" id="sel"/></td><td class="tg-left" id="frcol1"><input id="frnam" class="setnam0_css" value="1"/></td><td class="tg-left" id="frcol2"><input type="number" id="frdur" min="0" class="dur0_css" value="500"/></td><td class="tg-left" id="frcol3"><input id="frbeg" class="serial0_css" value=""/></td><td class="tg-left" id="frcol4"><input id="frend" class="serial0_css" value=""/></td></tr></tbody></table><table hidden id="sequences" class="tg"><thead><tr><th class="tg-left" id="seqselall"><input type="checkbox"/></th><th class="tg-left">Name</th><th class="tg-left">Duration</th></tr></thead><tbody><tr><td class="tg-left" id="seqcol0"><input type="checkbox" id="sel"/></td><td class="tg-left" id="seqcol1"><input id="seqNam" class="seqnam0_css" value="Sequence #1"/></td><td class="tg-left" id="seqcol2"><input id="compDur" class="seqdur0_css" value="" readonly="readonly"/></td></tr></tbody></table><table hidden id="settings" class="tg"><thead><tr><th class="tg-left" id="setselall"><input type="checkbox" checked="checked"/></th><th class="tg-left">Name</th><th class="tg-center">Min</th><th class="tg-center">Max</th><th class="tg-left"></th><th class="tg-center">Error</th></tr></thead><tbody><tr><td class="tg-left" id="setcol0"><input type="checkbox" id="srvena"/></td><td class="tg-left" id="setcol1"><input id="srvnam" class="nam0_css" value="Servo1"/></td><td class="tg-center" id="setcol2"><input type="number" id="srvmin" min="0" class="dur0_css" value="1000"/></td><td class="tg-center" id="setcol3"><input type="number" id="srvmax" min="0" class="dur0_css" value="2000"/></td><td class="tg-left" id="setcol4"><input type="checkbox" id="srvuseerr"/></td><td class="tg-center" id="setcol5"><input type="number" id="srverr" min="0" class="dur0_css" value="1000"/></td></tr></tbody></table><script src="FileSaver.js" charset="utf-8"></script><script src="ace.js" charset="utf-8"></script><script>var onRuntime;</script><script>/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";function e(){e=function(){return t};var t={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},a="function"==typeof Symbol?Symbol:{},s=a.iterator||"@@iterator",l=a.asyncIterator||"@@asyncIterator",c=a.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function d(e,t,n,r){var o=t&&t.prototype instanceof v?t:v,a=Object.create(o.prototype),s=new M(r||[]);return i(a,"_invoke",{value:x(e,n,s)}),a}function h(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var f={};function v(){}function p(){}function g(){}var m={};u(m,s,(function(){return this}));var y=Object.getPrototypeOf,C=y&&y(y(k([])));C&&C!==n&&r.call(C,s)&&(m=C);var w=g.prototype=v.prototype=Object.create(m);function L(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function n(i,a,s,l){var c=h(e[i],e,a);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==o(d)&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,s,l)}),(function(e){n("throw",e,s,l)})):t.resolve(d).then((function(e){u.value=e,s(u)}),(function(e){return n("throw",e,s,l)}))}l(c.arg)}var a;i(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,o){n(e,r,t,o)}))}return a=a?a.then(o,o):o()}})}function x(e,t,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return{value:void 0,done:!0}}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var s=S(a,n);if(s){if(s===f)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var l=h(e,t,n);if("normal"===l.type){if(r=n.done?"completed":"suspendedYield",l.arg===f)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(r="completed",n.method="throw",n.arg=l.arg)}}}function S(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,S(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),f;var o=h(r,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,f;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,f):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,f)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function M(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function k(e){if(e){var t=e[s];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:T}}function T(){return{value:void 0,done:!0}}return p.prototype=g,i(w,"constructor",{value:g,configurable:!0}),i(g,"constructor",{value:p,configurable:!0}),p.displayName=u(g,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,u(e,c,"GeneratorFunction")),e.prototype=Object.create(w),e},t.awrap=function(e){return{__await:e}},L(b.prototype),u(b.prototype,l,(function(){return this})),t.AsyncIterator=b,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new b(d(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},L(w),u(w,c,"Generator"),u(w,s,(function(){return this})),u(w,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=k,M.prototype={constructor:M,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=r.call(i,"catchLoc"),l=r.call(i,"finallyLoc");if(s&&l){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;E(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:k(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},t}function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,u(r.key),r)}}function n(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,o)}function r(e){return function(){var t=this,r=arguments;return new Promise((function(o,i){var a=e.apply(t,r);function s(e){n(a,o,i,s,l,"next",e)}function l(e){n(a,o,i,s,l,"throw",e)}s(void 0)}))}}function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function i(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=h(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){c(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t,n){return(t=u(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e){var t=function(e,t){if("object"!==o(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==o(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===o(t)?t:String(t)}function d(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,s=[],l=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=i.call(n)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(e){c=!0,o=e}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return s}}(e,t)||h(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(e,t){if(e){if("string"==typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(e,t):void 0}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var v,p="output",g="frames",m="sequences",y="settings",C="script_editor",w=p,L=new Map;L.set("1",{srvena:!0,srvmin:1e3,srvmax:2e3,srvuseerr:!1,srverr:1e3}),L.set("2",{srvena:!0,srvmin:1e3,srvmax:2e3,srvuseerr:!1,srverr:1e3}),L.set("3",{srvena:!0,srvmin:1e3,srvmax:2e3,srvuseerr:!1,srverr:1e3}),L.set("4",{srvena:!0,srvmin:1e3,srvmax:2e3,srvuseerr:!1,srverr:1e3});var b={srvena:!1,srvpos:0,srvdur:50,srveas:0},x=new Map;x.set("1",{srvena:!0,srvnam:"1",srvpos:80,srvdur:10,srveas:5}),x.set("2",{srvena:!0,srvnam:"2",srvpos:20,srvdur:20,srveas:4}),x.set("3",{srvena:!0,srvnam:"3",srvpos:90,srvdur:30,srveas:6}),x.set("4",{srvena:!0,srvnam:"4",srvpos:50,srvdur:40,srveas:7});var S=null,_=[],E=new Map,M="",k=[],T="",q=null,O=_.length-1,P=L,I=[x],N=1,A=I.length-1;function R(e){var t=document.getElementById(e);return null==t&&console.log("Not found:",e),t}function F(e){var t,n,r,o,i,a,s,l,c=document.styleSheets;for(o=0,s=c.length;o<s;o++)if((t=c[o]).cssRules){for(i=0,l=(n=t.cssRules).length;i<l;i++)if((r=n[i]).selectorText==e)return parseInt(r.style.width.slice(0,-2))}else if(t.rules)for(n=t.rules,a=0,kLen=n.length;a<kLen;a++)if((r=n[a]).selectorText==e)return parseInt(r.style.width.slice(0,-2));return 0}function H(e,t){var n,r,o,i,a,s,l,c,u=document.styleSheets;for(i=0,l=u.length;i<l;i++)if((n=u[i]).cssRules)for(a=0,c=(r=n.cssRules).length;a<c;a++)(o=r[a]).selectorText==e&&(o.style.width=t+"px");else if(n.rules)for(r=n.rules,s=0,kLen=r.length;s<kLen;s++)(o=r[s]).selectorText==e&&(o.style.width=t+"px")}function D(){for(var e=R("output"),t=e.rows.length,n=e.rows[0].cells.length,r=e.insertRow(t),o=0;o<n;o++){var i="cell"+o;i=r.insertCell(o);var a=R("col"+o).innerHTML;i.innerHTML=a,i.onchange=pe}}function j(){for(var e=R("frames"),t=e.rows.length,n=e.rows[0].cells.length,r=e.insertRow(t),o=0;o<n;o++){var i="cell"+o;i=r.insertCell(o);var a=R("frcol"+o).innerHTML;i.innerHTML=a,i.onchange=ge}}function U(){for(var e=R("settings"),t=e.rows.length,n=e.rows[0].cells.length,r=e.insertRow(t),o=0;o<n;o++){var i="cell"+o;i=r.insertCell(o);var a=R("setcol"+o).innerHTML;i.innerHTML=a,i.onchange=ye}}function z(){for(var e=R("sequences"),t=e.rows.length,n=e.rows[0].cells.length,r=e.insertRow(t),o=0;o<n;o++){var i="cell"+o;i=r.insertCell(o);var a=R("seqcol"+o).innerHTML;i.innerHTML=a,i.onchange=me}}function W(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(function(e){return(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)}))}function J(){var e=R("settings");Y(e,P.length,U);for(var t=0;t<P.length;t++)for(var n=e.rows[t+1],r=P[t],o=0,i=Object.entries(r);o<i.length;o++){var a=d(i[o],2),s=a[0],l=a[1],c=n.querySelector("#"+s);c.checked=l,c.value=l}}function Z(){var e,t,n,r,o,i=R("sequences");Y(i,_.length,z);for(var a=0;a<_.length;a++){for(var s=i.rows[a+1],l=_[a],c=0,u=Object.entries(l);c<u.length;c++){var h=d(u[c],2),f=h[0],v=h[1],p=s.querySelector("#"+f);null!=p&&(p.checked=v,p.value=v)}var g=s.querySelector("#compDur");null!=g&&(g.value=(t=void 0,n=void 0,r=void 0,o=void 0,t=(e=ne(l,0))%1e3,n=Math.floor(e/1e3%60),r=Math.floor(e/6e4%60),(o=(o=Math.floor(e/36e5%24))>0?String(o).padStart(2,"0")+":":"")+(r=String(r).padStart(2,"0"))+":"+(n=String(n).padStart(2,"0"))+"."+(t=String(t).padStart(3,"0")))),null!=(g=s.querySelector("#sel"))&&(g.checked=null!=q&&l.seqID==q.seqID)}}function Y(e,t,n){for(;e.rows.length-1>t;)e.deleteRow(e.rows.length-1);for(var r=e.rows.length-1;r<t;r++)n()}function B(){var e,t=R("output"),n=t.rows.length,r=I[A];Y(t,P.length,D);for(var o=1;o<n;o++){var i=t.rows[o],a=o.toString();i.querySelector("#srvnam").value=(e=o)>0&&e<P.length?P[e-1].srvnam:"Servo"+e;var s=r[a];r.hasOwnProperty(a)||(s=b);for(var l=0,c=Object.entries(s);l<c.length;l++){var u=d(c[l],2),h=u[0],f=u[1],v=i.querySelector("#"+h);v.checked=f,v.value=f}}R("navbarinfo").innerHTML=A+1+" ("+I.length+")"}function G(e){var t=e==I.length-1;if(I.length<99){var n=JSON.parse(JSON.stringify(I[e]));if(n.frnam=(N++).toString(),n.frbeg="",n.frend="",t)for(var r=0;r<P.length;r++){var o=r.toString();n.hasOwnProperty(o)&&(n[o].srvena=!1)}return A==I.length-1?I.push(n):I.splice(A,0,n),e<=A&&A++,!0}return!1}function V(){return I.length<99&&(I.push({frnam:(N++).toString(),frbeg:"",frend:"",frdur:50}),A=I.length-1,!0)}function X(e){for(var t=0;t<_.length;t++)if(e==_[t].seqNam)return!1;return!0}function K(e){if(e<_.length){var t=JSON.parse(JSON.stringify(_[e]));t.seqID=W();var n=t.seqNam,r=/[0-9]+$/.test(a=n)?a.match(/[0-9]+$/)[0]:null;null!=r?n=n.substring(0,n.length-r.length):n+=" #";for(var o=0;;o++){var i=n+(_.length+o);if(X(i)){n=i;break}}return t.seqNam=n,O==_.length-1?(_.push(t),$(_.length-1)):(_.splice(O,0,t),$(O+1)),!0}var a;return!1}function $(e){e<_.length&&(q=_[O=e],I=q.seqframes,A=I.length-1,N=I.length+1,function(e){for(var t=[],n=Array(P.length).fill(0),r=0;r<P.length;r++){var o=P[r];if(o.srvena){for(var i=[],a=0,s=(r+1).toString(),l=0;l<e.length;l++){var c=e[l];if(c.hasOwnProperty(s)){var u=c[s];u.srvena&&(i.push({time:a/10,value:n[r]/1e3,_color:"#"+(16777215*Math.random()|0).toString(16),tween:"linear"}),n[r]=u.srvpos,i.push({time:(a+10*u.srvdur)/10,value:n[r]/1e3,_color:"#"+(16777215*Math.random()|0).toString(16)}))}a=10*c.frdur}0!=i.length&&t.push({name:o.srvnam,values:i})}}var d={version:"1.2.0",modified:(new Date).toString(),layers:t};console.log("timeline:",JSON.stringify(d)),S.load(d)}(I))}function Q(e,t){var n=!1,r=R(e),o=r.rows.length;if(t)for(var i=1;i<r.rows.length;i++){var a=r.rows[i];if(a.querySelector("#sel").checked){if(!(i>1))break;if(a.parentNode.insertBefore(a,r.rows[i-1]),w==g){var s=I[i-2];I[i-2]=I[i-1],I[i-1]=s}else if(w==m){var l=_[i-2];_[i-2]=_[i-1],_[i-1]=l}n||(r.rows[i-1].scrollIntoView({behavior:"smooth",block:"center"}),n=!0)}}else{for(var c=null,u=r.rows.length-1;u>=1;u--){var d=r.rows[u];if(d.querySelector("#sel").checked){if(!(u<o-1))break;if(d.parentNode.insertBefore(r.rows[u+1],d),c=r.rows[u+1],w==g){var h=I[u];I[u]=I[u-1],I[u-1]=h}else if(w==m){var f=_[u];_[u]=_[u-1],_[u-1]=f}}}null!=c&&c.scrollIntoView({behavior:"smooth",block:"center"})}w==g&&ue()}function ee(e){if(e.length>0){var t=e[0];changedSequences.shift();var n=new URLSearchParams;n.append("id",t),fetch("/api/delete?"+n).then((function(n){n.ok?E.delete(t):alert("Failed to delete sequence: "+t),ee(e)})).catch((function(e){console.log("Error:",e),alert("Failed to upload sequence: "+t)}))}else ke()}function te(e,t){var n,r=-1,i=!1;if("sequence"==e?(r=0,i=!0):"sequences"==e?(r=1,i=!0):"settings"==e&&(r=2),-1!=r){var a=(n=[],function e(t,r){if(t&&t.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0!==t){if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!==o(t))return JSON.stringify(t);var i,a;if(Array.isArray(t)){for(a="[",i=0;i<t.length;i++)i&&(a+=","),a+=e(t[i])||"null";return a+"]"}if(null===t)return"null";if(-1!==n.indexOf(t))throw new TypeError("Not supported");var s=n.push(t)-1,l=Object.keys(t).sort((function(e,t){return isNaN(e)?isNaN(t)&&e>t?1:-1:isNaN(t)?-1:parseInt(e)>parseInt(t)?1:-1}));for(a="",i=0;i<l.length;i++){var c=l[i],u=e(t[c]);u&&(a&&(a+=","),a+=JSON.stringify(c)+":"+u)}return n.splice(s,1),"{"+a+"}"}}(t)),s=new Uint8Array(Te(a)),l=Module._malloc(s.length+1);Module.HEAPU8.set(s,l);var c=i?Module._deflateJSON(r,l,s.length):Module._encodeJSON(r,l,s.length);if(Module._free(l),null!=c){var u=UTF8ToString(c);return Module._free(c),u}}else console.log("bad encode type:",e);return null}function ne(e,t){for(var n=0,r=e.seqframes,o=t;o<r.length;o++){var i=r[o],a=Number(i.frdur);if(0==a)for(var s=0;s<P.length;s++){var l=(s+1).toString();if(i.hasOwnProperty(l)){var c=i[l];a<Number(c.srvdur)&&(a=Number(c.srvdur))}}n+=a}return 10*n}function re(e){var t=new URLSearchParams;t.append("id",e);var n=0;w==p&&(n=A,t.append("num",n));var r=function(e,t){for(var n=0,r=0;r<_.length;r++)if(e==_[r].seqID){n=ne(_[r],t);break}return n}(e,n);fetch("/api/play?"+t).then((function(e){e.ok&&(R("playSeq").hidden=!0,R("stopSeq").hidden=!1,console.log("duration:",r),setTimeout((function(){R("playSeq").hidden=!1,R("stopSeq").hidden=!0}),r))})).catch((function(e){console.log(e)}))}function oe(){fetch("/api/stop").then((function(e){e.ok&&(R("playSeq").hidden=!1,R("stopSeq").hidden=!0)})).catch((function(e){console.log(e)}))}function ie(e,t,n){if(null!=e){var r=te("sequence",e);if(null==r)return void console.log("Internal error. Failed to encode sequence.");var o=!1;E.has(e.seqID)?E.get(e.seqID)!=r&&(o=!0):o=!0,o?(Me(),we(e.seqID,r).then((function(o){o.ok?(E.set(e.seqID,r),t&&re(e.seqID)):alert(n)})).catch((function(e){alert(n)}))):t&&re(e.seqID)}}function ae(){var e=R("sequences").rows.length-1;Me();for(var t=[],n=0;n<e;n++){var r=_[n],o=te("sequence",r);if(null==o)return void console.log("Internal error. Failed to encode sequence.");var i=!1;E.has(r.seqID)?E.get(r.seqID)!=o&&(i=!0):i=!0,i&&t.push({id:r.seqID,data:o})}se(t)}function se(e){if(e.length>0){var t=e[0];e.shift(),we(t.id,t.data).then((function(n){n.ok?E.set(t.id,t.data):alert("Failed to upload sequence: "+t.id),se(e)})).catch((function(e){console.log("Error:",e),alert("Failed to upload sequence: "+t.id)}))}else ke()}function le(){ie(q,!0,"Failed to upload sequence. Unable to play")}function ce(){var e=R("frames");Y(e,I.length,j);for(var t=0;t<I.length;t++){var n=e.rows[t+1],r=I[t],o=n.querySelector("#sel");for(var i in o.checked=A==t,r)if(i.startsWith("fr")){var a=r[i],s=n.querySelector("#"+i);s.checked=a,s.value=a}}N=I.length+1,e.rows[A].scrollIntoView({behavior:"smooth",block:"center"})}function ue(){if(w==g)for(var e=R("frames"),t=e.rows.length,n=1;n<t;n++)if(e.rows[n].querySelector("#sel").checked){A=n-1;break}}function de(){ue(),w=p,R("output").hidden=!1,null!=S&&S.hide(),R("frames").hidden=!0,R("sequences").hidden=!0,R("settings").hidden=!0,R("script_editor").hidden=!0,R("add_button").hidden=!1,R("edit_button").hidden=!0,R("up_button").hidden=!0,R("down_button").hidden=!0,R("del_button").hidden=!1,R("prevFrame").hidden=!1,R("nextFrame").hidden=!1,R("navbarinfo").hidden=!1,R("sync_script").hidden=!0,R("upload_button").hidden=!0,B()}function he(e){if(w==p||w==g){var t=!1,n=!1;try{var r=JSON.parse(e);if(r.hasOwnProperty("seqID")&&r.hasOwnProperty("seqNam")&&r.hasOwnProperty("seqframes")){console.log("seq2:",r);var o,a=i(r.seqframes);try{for(a.s();!(o=a.n()).done;){var s=o.value;if(console.log("frame:",s),!(s.hasOwnProperty("frdur")&&s.hasOwnProperty("frnam")&&s.hasOwnProperty("frbeg")&&s.hasOwnProperty("frend"))){t=!0;break}if(I.length<99){var l=JSON.parse(JSON.stringify(s));l.frnam=isNaN(s.frnam)?s.frnam:(N++).toString(),l.frbeg=s.frbeg,l.frend=s.frend,l.frdur=s.frdur,console.log("newFrame:",l),I.push(l),n=!0}}}catch(e){a.e(e)}finally{a.f()}}else t=!0}catch(e){console.log("error:",e),t=!0}t?alert("Invalid sequence file."):n&&ce()}else if(w==m){var c=!1;try{var u,d=i(JSON.parse(e));try{var h=function(){var e=u.value,t=te("sequence",e);null!=t?we(e.seqID,t).then((function(n){n.ok?E.set(activeSquence.seqID,t):alert("Failed to upload sequence: "+e.seqNam)})).catch((function(t){alert("Failed to upload sequence: "+e.seqNam)})):c=!0};for(d.s();!(u=d.n()).done;)h()}catch(e){d.e(e)}finally{d.f()}}catch(e){c=!0}c&&alert("Invalid sequences file.")}else if(w==y){var f=!1;try{for(var L=JSON.parse(e),b=0;b<L.length;b++){var x=L[b];if(!(x.hasOwnProperty("srvena")&&x.hasOwnProperty("srverr")&&x.hasOwnProperty("srvmax")&&x.hasOwnProperty("srvmin")&&x.hasOwnProperty("srvnam")&&x.hasOwnProperty("srvuseerr"))){console.log("bad:",x),f=!0;break}}if(!f){P=L.map((function(e){return{srvena:e.srvena,srverr:e.srverr,srvmax:e.srvmax,srvmin:e.srvmin,srvnam:e.srvnam,srvuseerr:e.srvuseerr}})),J();var S=te("settings",P);null!=S&&be(S).then((function(e){e.ok||alert("Failed to upload settings.")})).catch((function(e){alert("Failed to upload settings.")}))}}catch(e){f=!0}f&&alert("Invalid servo settings.")}else w==C&&(v.setValue(e),v.getSession().setAnnotations([{}]))}function fe(e){if(w==g){for(var t=R("frames"),n=t.rows.length-1,r=0,o=0;o<n;o++)t.rows[o+1].querySelector("#sel").checked&&r++;for(var i=r!=n,a=0;a<n;a++)t.rows[a+1].querySelector("#sel").checked=i}else if(w==y){for(var s=R("settings"),l=s.rows.length-1,c=0,u=0;u<l;u++)s.rows[u+1].querySelector("#srvena").checked&&c++;for(var d=c!=l,h=0;h<l;h++)s.rows[h+1].querySelector("#srvena").checked=d;ve(0,"srvena",e.checked)}else if(w==m){for(var f=R("sequences"),v=f.rows.length-1,p=0,C=0;C<v;C++)f.rows[C+1].querySelector("#sel").checked&&p++;for(var L=p!=v,b=0;b<v;b++)f.rows[b+1].querySelector("#sel").checked=L}e.checked=!1}function ve(e,t,n){var r=new URLSearchParams;r.append("srv",e-1==-1?"ALL":e-1),r.append(t.substring(3),n),fetch("/api/changeSetting?"+r).catch((function(e){console.log(e)}))}function pe(e){var t=e.target;console.log("fld:",t);for(var n=R("output"),r=n.rows.length,o=I[A],i=1;i<r;i++){var a=n.rows[i];if(a.querySelector("#"+t.id)==t){var s=t.value;if("checkbox"!=t.type?"number"==typeof t.value?t.value=parseInt(t.value):t.value=t.value.substring(0,64):s=t.checked,"srvnam"==t.id&&(P[i-1][t.id]=s),"srvnam"!=t.id&&"srvpos"!=t.id||ve(i,t.id,s),"srvnam"!=t.id){var c=i.toString();if("srvpos"==t.id&&(a.querySelector("#srvena").checked=!0),!o.hasOwnProperty(c)){var u=l({},b);u.srvena=a.querySelector("#srvena").checked,u.srvpos=a.querySelector("#srvpos").value,u.srvdur=a.querySelector("#srvdur").value,u.srveas=a.querySelector("#srveas").value,o[c]=u}var d=o[c];d[t.id]="checkbox"==t.type?t.checked:"number"==typeof t.value?parseInt(t.value):t.value,"srvpos"==t.id&&(d.srvena=!0)}}}}function ge(e){for(var t=e.target,n=R("frames"),r=n.rows.length,o=1;o<r;o++)n.rows[o].querySelector("#"+t.id)==t&&"#sel"!=t.id&&(I[o-1][t.id]="number"==typeof t.value?parseInt(t.value):t.value)}function me(e){for(var t=e.target,n=R("sequences"),r=n.rows.length,o=1;o<r;o++)n.rows[o].querySelector("#"+t.id)==t&&"#sel"!=t.id&&(_[o-1][t.id]="number"==typeof t.value?parseInt(t.value):t.value)}function ye(e){for(var t=e.target,n=R("settings"),r=n.rows.length,o=1;o<r;o++)if(n.rows[o].querySelector("#"+t.id)==t){var i=t.value;"checkbox"!=t.type?"number"==typeof t.value?t.value=parseInt(t.value):t.value=t.value.substring(0,64):i=t.checked,P[o-1][t.id]=i,ve(o,t.id,i)}}function Ce(){_.push({seqID:W(),seqNam:"Sequence #"+(_.length+1),seqframes:[{frdur:50,frnam:"1",frbeg:"",frend:""}]}),$(_.length-1);for(var e=0;e<P.length;e++)(t=e+1,n=void 0,r=void 0,o=void 0,n=t.toString(),r=I[A],o=null,r.hasOwnProperty(n)?o=r[n]:((o=l({},b)).srvena=!1,r[n]=o),o).srvena=P[e].srvena;var t,n,r,o}function we(e,t){return Le.apply(this,arguments)}function Le(){return(Le=r(e().mark((function t(n,r){var o,i,a;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(o=new URLSearchParams).append("id",n),i="/api/upload/sequence?"+o,e.next=5,fetch(i,{method:"POST",headers:{"Content-Type":"application/base64"},body:r});case 5:return a=e.sent,e.abrupt("return",a);case 7:case"end":return e.stop()}}),t)})))).apply(this,arguments)}function be(){return xe.apply(this,arguments)}function xe(){return xe=r(e().mark((function t(){var n,r,o=arguments;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>0&&void 0!==o[0]?o[0]:"",e.next=3,fetch("/api/upload/settings",{method:"POST",headers:{"Content-Type":"application/base64"},body:n});case 3:return r=e.sent,e.abrupt("return",r);case 5:case"end":return e.stop()}}),t)}))),xe.apply(this,arguments)}function Se(){return Se=r(e().mark((function t(){var n,r,o=arguments;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>0&&void 0!==o[0]?o[0]:"",e.next=3,fetch("/api/upload/script",{method:"POST",headers:{"Content-Type":"application/base64"},body:n});case 3:return r=e.sent,e.abrupt("return",r);case 5:case"end":return e.stop()}}),t)}))),Se.apply(this,arguments)}function _e(){return _e=r(e().mark((function t(){var n,r,o=arguments;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>0&&void 0!==o[0]?o[0]:"",e.next=3,fetch("/api/upload/order",{method:"POST",headers:{"Content-Type":"application/base64"},body:n});case 3:return r=e.sent,e.abrupt("return",r);case 5:case"end":return e.stop()}}),t)}))),_e.apply(this,arguments)}function Ee(){return Ee=r(e().mark((function t(){var n,r,o=arguments;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>0&&void 0!==o[0]?o[0]:"",e.next=3,fetch("/api/upload/virtuoso",{method:"POST",headers:{"Content-Type":"application/base64"},body:n});case 3:return r=e.sent,e.abrupt("return",r);case 5:case"end":return e.stop()}}),t)}))),Ee.apply(this,arguments)}function Me(){var e=te("settings",P);null!=e&&e!=T&&be(e).then((function(t){t.ok?T=e:alert("Failed to upload settings.")})).catch((function(e){alert("Failed to upload settings.")}))}function ke(){for(var e=[],t=0;t<_.length;t++)e.push(_[t].seqID);var n=JSON.stringify(e);if(M!=n){var r=new Uint8Array(Te(n)),o=Module._malloc(r.length+1);Module.HEAPU8.set(r,o);var i=Module._encodeText(o,r.length);if(Module._free(o),null!=i){var a=UTF8ToString(i);Module._free(i),function(){return _e.apply(this,arguments)}(a).then((function(e){e.ok?M=n:console.log("Failed to upload sequence order")})).catch((function(e){console.log("Failed to upload sequence order:",e)}))}}}function Te(e){for(var t=[],n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t.push(r):r<2048?t.push(192|r>>6,128|63&r):r<55296||r>=57344?t.push(224|r>>12,128|r>>6&63,128|63&r):(n++,r=65536+((1023&r)<<10|1023&e.charCodeAt(n)),t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r))}return t}window.onclick=function(e){if(!e.target.matches(".dropbtn"))for(var t=document.getElementsByClassName("dropdown-content"),n=0;n<t.length;n++){var r=t[n];r.classList.contains("show")&&r.classList.remove("show")}},"file:"==window.location.protocol?alert("Not supported."):(B(),J(),de()),R("add_button").onclick=function(e){if(w==p)G(A)&&B();else if(w==g){for(var t=!1,n=R("frames"),r=n.rows.length-1,o=0;o<r;o++)if(n.rows[o+1].querySelector("#sel").checked&&G(o)){t=!0,ce();break}!t&&V()&&ce()}else if(w==m){for(var i=!1,a=R("sequences"),s=a.rows.length-1,l=0;l<s;l++)if(a.rows[l+1].querySelector("#sel").checked&&K(l)){i=!0;break}i||(Ce(),$(_.length-1)),Z()}},R("edit_button").onclick=function(){if(w==g){for(var e=R("frames"),t=e.rows.length-1,n=0;n<t;n++)if(e.rows[n+1].querySelector("#sel").checked){A=n,de();break}}else if(w==m)for(var r=R("sequences"),o=r.rows.length-1,i=0;i<o;i++)if(r.rows[i+1].querySelector("#sel").checked){$(i),de();break}},R("up_button").onclick=function(){w!=g&&w!=m||Q(w,!0)},R("down_button").onclick=function(){w!=g&&w!=m||Q(w,!1)},R("del_button").onclick=function(){if(w==p)h=A,I.length>1&&(I.splice(h,1),h<=A&&--A<0&&(A=0),1)&&B();else if(w==g){var e=function(){for(var e=0,t=R("frames"),n=t.rows.length-1,r=0;r<n;)t.rows[r+1].querySelector("#sel").checked&&e++,r++;return e}();if(e>1&&!confirm("You are about to delete "+e+" frames. Are you sure?"))return;for(var t=R("frames"),n=t.rows.length-1,r=-1,o=0;o<n;)if(t.rows[o+1].querySelector("#sel").checked){if(-1==r&&(r=o),I.splice(o,1),1==n)break;t.deleteRow(o+1),n=t.rows.length-1}else o++;0==I.length&&V(),A=r<I.length?r:I.length-1,t.rows[A+1].querySelector("#sel").checked=!0,1==I.length&&ce()}else if(w==m){var i=function(){for(var e=0,t=R("sequences"),n=t.rows.length-1,r=0;r<n;)t.rows[r+1].querySelector("#sel").checked&&e++,r++;return e}();if(0==i)return;if(1==i&&!confirm("You are about to delete the selected sequence. Are you sure?"))return;if(i>1&&!confirm("You are about to delete "+i+" sequences. Are you sure?"))return;for(var a=R("sequences"),s=a.rows.length-1,l=-1,c=[],u=0;u<s;)if(a.rows[u+1].querySelector("#sel").checked){-1==l&&(l=u);var d=_[u].seqID;if(E.has(d)&&c.push(d),_.splice(u,1),1==s)break;a.deleteRow(u+1),s=a.rows.length-1}else u++;c.length>0&&ee(c),0==_.length?(Ce(),I=q.seqframes,A=I.length-1,N=I.length+1):$(l<_.length?l:_.length-1),a.rows[O+1].querySelector("#sel").checked=!0,1==_.length&&Z()}var h},R("playSeq").onclick=le,R("stopSeq").onclick=oe,R("prevFrame").onclick=function(){A>0&&(A--,B())},R("nextFrame").onclick=function(){A+1<I.length&&(A++,B())},R("sync_script").onclick=function(){var e="\n";e+="### Sequence subroutines: ###\n",e+="\n";for(var t=0;t<_.length;t++){e+="# Sequence "+t+"\n",e+="sub Sequence_"+t+"\n";for(var n=0;n<I.length;n++){var r=I[n];if(r.hasOwnProperty("frbeg")){var o=r.frbeg;if(o.length>0){for(e+="  ",a=0;a<o.length;a++)o.charCodeAt(a),e+="0x"+o.charCodeAt(a).toString(16)+" ";e+=" 0x00 serial_send\n"}}for(var i=0;i<P.length;i++){var s=(i+1).toString();if(r.hasOwnProperty(s)){var l=r[s];l.srvena&&(e+="  "+l.srveas+" "+l.srvdur+" "+l.srvpos+" "+i+" servox\n")}}var c=10*r.frdur;if(e+=0==c?"  begin get_moving_state while repeat\n":"  "+c+" delay\n",r.hasOwnProperty("frend")){var u=r.frend;if(console.log(u),u.length>0){for(e+="  ",a=0;a<u.length;a++)e+="0x"+u.charCodeAt(a).toString(16)+" ";e+="0x00 serial_send\n"}}}e+="  return\n",e+="\n"}v.setValue(e),v.getSession().setAnnotations([{}]),v.session.setUndoManager(new ace.UndoManager)},R("upload_button").onclick=function(){w==g&&ie(q,!1,"Failed to upload sequence."),w==m?ae():w==y?Me():w==C&&function(){var e=v.getValue();v.getSession().setAnnotations([{}]);var t=new Uint8Array(Te(e)),n=Module._malloc(t.length+1);Module.HEAPU8.set(t,n);var r=Module._encodeText(n,t.length);if(Module._free(n),null!=r){var o=UTF8ToString(r);Module._free(r),function(){return Se.apply(this,arguments)}(o).then((function(t){if(t.ok){var n=new Uint8Array(Te(e)),r=Module._malloc(n.length+1);Module.HEAPU8.set(n,r);var o=Module._compile(r,n.length);if(Module._free(r),null!=o){var i=UTF8ToString(o);Module._free(o),function(){return Ee.apply(this,arguments)}(i).then((function(e){e.ok&&alert("Uploaded")})).catch((function(e){console.log("Failed to upload script:",e)}))}}})).catch((function(e){console.log("Failed to upload script:",e)}))}}()},R("navbarinfo").onclick=function(){if(w==p){var e=parseInt(prompt("Enter frame number (1-"+I.length+")",""+(A+1)));e>=1&&e<=I.length&&(A=e-1,B())}},R("dropbtn").onclick=function(){R("dropdown-content").classList.toggle("show")},R("showAnimate").onclick=de,R("showTimeline").onclick=function(){ue(),w=p,R("output").hidden=!0,R("frames").hidden=!0,null!=S&&S.show(),R("sequences").hidden=!0,R("settings").hidden=!0,R("script_editor").hidden=!0,R("add_button").hidden=!1,R("edit_button").hidden=!0,R("up_button").hidden=!0,R("down_button").hidden=!0,R("del_button").hidden=!1,R("prevFrame").hidden=!1,R("nextFrame").hidden=!1,R("navbarinfo").hidden=!1,R("sync_script").hidden=!0,R("upload_button").hidden=!0,B()},R("showFrames").onclick=function(){ue(),w=g,R("output").hidden=!0,null!=S&&S.hide(),R("frames").hidden=!1,R("sequences").hidden=!0,R("settings").hidden=!0,R("script_editor").hidden=!0,R("add_button").hidden=!1,R("edit_button").hidden=!1,R("up_button").hidden=!1,R("down_button").hidden=!1,R("del_button").hidden=!1,R("prevFrame").hidden=!0,R("nextFrame").hidden=!0,R("navbarinfo").hidden=!0,R("sync_script").hidden=!0,R("upload_button").hidden=!1,ce()},R("showSequences").onclick=function(){ue(),w=m,R("output").hidden=!0,null!=S&&S.hide(),R("frames").hidden=!0,R("sequences").hidden=!1,R("settings").hidden=!0,R("script_editor").hidden=!0,R("add_button").hidden=!1,R("edit_button").hidden=!1,R("up_button").hidden=!1,R("down_button").hidden=!1,R("del_button").hidden=!1,R("prevFrame").hidden=!0,R("nextFrame").hidden=!0,R("navbarinfo").hidden=!0,R("sync_script").hidden=!0,R("upload_button").hidden=!1,Z()},R("showSettings").onclick=function(){ue(),w=y,R("output").hidden=!0,null!=S&&S.hide(),R("frames").hidden=!0,R("sequences").hidden=!0,R("settings").hidden=!1,R("script_editor").hidden=!0,R("add_button").hidden=!0,R("up_button").hidden=!0,R("down_button").hidden=!0,R("edit_button").hidden=!0,R("del_button").hidden=!0,R("prevFrame").hidden=!0,R("nextFrame").hidden=!0,R("navbarinfo").hidden=!0,R("sync_script").hidden=!0,R("upload_button").hidden=!1,J()},R("showScript").onclick=function(){ue(),w=C,R("output").hidden=!0,null!=S&&S.hide(),R("frames").hidden=!0,R("sequences").hidden=!0,R("settings").hidden=!0,R("script_editor").hidden=!1,R("add_button").hidden=!0,R("edit_button").hidden=!0,R("up_button").hidden=!0,R("down_button").hidden=!0,R("del_button").hidden=!0,R("prevFrame").hidden=!0,R("nextFrame").hidden=!0,R("navbarinfo").hidden=!0,R("sync_script").hidden=!1,R("upload_button").hidden=!1},R("saveToFile").onclick=function(){if(w==p){var e=new Blob([JSON.stringify(q,void 0,4)],{type:"application/json;charset=utf-8"});saveAs(e,q.seqNam+".json")}else if(w==g){for(var t=[],n=R("frames"),r=n.rows.length-1,o=0;o<r;o++)n.rows[o+1].querySelector("#sel").checked&&t.push(I[o]);if(0!=t.length){var i={seqID:q.seqID,seqNam:q.seqNam,seqframes:t},a=new Blob([JSON.stringify(i,void 0,4)],{type:"application/json;charset=utf-8"});saveAs(a,i.seqNam+".json")}else alert("No frames selected")}else if(w==m){for(var s=[],l=R("sequences"),c=l.rows.length-1,u=0;u<c;u++)l.rows[u+1].querySelector("#sel").checked&&s.push(_[u]);if(0!=s.length){var d=new Blob([JSON.stringify(s,void 0,4)],{type:"application/json;charset=utf-8"});saveAs(d,"sequences.json")}else alert("No sequences selected")}else if(w==y){var h=new Blob([JSON.stringify(P,void 0,4)],{type:"application/json;charset=utf-8"});saveAs(h,"servoSettings.json")}else if(w==C){var f=new Blob([v.getValue()],{type:"text/plain;charset=utf-8"});saveAs(f,"virtuoso.text")}},R("openFile").onclick=function(){!function(e){var t=document.createElement("input");t.type="file",t.style.display="none",t.onchange=function(e){var n=e.target.files[0];if(n){var r=new FileReader;r.onload=function(e){var n=e.target.result;t.func(n),document.body.removeChild(t)},r.readAsText(n)}},t.func=e,document.body.appendChild(t);var n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),t.dispatchEvent(n)}(he)},R("col0").onchange=pe,R("col1").onchange=pe,R("col2").onchange=pe,R("col3").onchange=pe,R("col4").onchange=pe,R("frselall").onchange=fe,R("frcol1").onchange=ge,R("frcol2").onchange=ge,R("frcol3").onchange=ge,R("frcol4").onchange=ge,R("seqselall").onchange=fe,R("seqcol1").onchange=me,R("setselall").onchange=fe,R("setcol0").onchange=ye,R("setcol1").onchange=ye,R("setcol2").onchange=ye,R("setcol3").onchange=ye,R("setcol4").onchange=ye,R("setcol5").onchange=ye;var qe=F(".nam0_css"),Oe=(F(".pos0_css"),F(".eas0_css")),Pe=F(".seqnam0_css"),Ie=F(".setnam0_css"),Ne=F(".serial0_css");function Ae(){var e=document.documentElement.clientWidth/1.2,t=Math.max(e/6,qe),n=Math.max(e/100*20,Ne),r=Math.max(e/100*60,Pe),o=Math.max(e/100*20,Ie),i=Math.min(Math.max(e/6,Oe),100),a=(e-t-i)/1.3;H(".nam0_css",t),H(".pos0_css",a),H(".eas0_css",i),H(".seqnam0_css",r),H(".setnam0_css",o),H(".serial0_css",n),H(".navbar",document.documentElement.clientWidth)}function Re(e,t){this.state=e.getJSONString(),this.description=t}function Fe(e,t){this.dispatcher=e,this.MAX_ITEMS=t||100,this.clear()}function He(){var e={};this.on=function(t,n){t in e||(e[t]=[]),e[t].push(n)},this.fire=function(t){var n=Array.prototype.slice.call(arguments);n.shift();var r=e[t];if(r)for(var o=0;o<r.length;o++){var i=r[o];i.apply(i,n)}}}Ae(),window.onresize=Ae,(v=ace.edit("script_editor")).setOptions({}),Fe.prototype.save=function(e,t){var n=this.states,r=this.index+1,o=n.length-r;n.splice(r,o,e),n.length>this.MAX_ITEMS&&n.shift(),this.index=n.length-1,t||this.dispatcher.fire("state:save",e.description)},Fe.prototype.clear=function(){this.states=[],this.index=-1},Fe.prototype.canUndo=function(){return this.index>0},Fe.prototype.canRedo=function(){return this.index<this.states.length-1},Fe.prototype.undo=function(){return this.canUndo()?(this.dispatcher.fire("status","Undo: "+this.get().description),this.index--):this.dispatcher.fire("status","Nothing to undo"),this.get()},Fe.prototype.redo=function(){return this.canRedo()?(this.index++,this.dispatcher.fire("status","Redo: "+this.get().description)):this.dispatcher.fire("status","Nothing to redo"),this.get()},Fe.prototype.get=function(){return this.states[this.index]};var De,je,Ue="#343434",ze="#535353",We="#b8b8b8",Je="#d6d6d6",Ze={LINE_HEIGHT:26,DIAMOND_SIZE:10,MARKER_TRACK_HEIGHT:60,width:600,height:400,TIMELINE_SCROLL_HEIGHT:0,LEFT_PANE_WIDTH:250,time_scale:60,default_length:20,DEFAULT_TIME_SCALE:60},Ye={none:function(e){return 0},linear:function(e){return e},quadEaseIn:function(e){return e*e},quadEaseOut:function(e){return-e*(e-2)},quadEaseInOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}};function Be(e){var t=e.target.files;console.log("handle file select",t.length);var n=t[0];if(n){console.log("match",n.type);var r=new FileReader;r.onload=function(e){var t=e.target.result;je(t)},r.readAsText(n),De.value=""}}function Ge(e){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}var Ve="timeliner-",Xe=function(){for(var e=0;e<arguments.length;e++)if(void 0!==arguments[e])return arguments[e]},Ke=function(e){for(var t=0;t<(arguments.length<=1?0:arguments.length-1);++t){var n=t+1<1||arguments.length<=t+1?void 0:arguments[t+1];for(var r in n)e.style[r]=n[r]}},$e=function(e,t){var n=document.createElement("a");document.body.appendChild(n),n.style="display: none";var r=new Blob([e],{type:"octet/stream"}),o=window.URL.createObjectURL(r);n.href=o,n.download=t,Ge(n),setTimeout((function(){window.URL.revokeObjectURL(o),document.body.removeChild(n)}),500)},Qe=function(e,t){console.log("openfile..."),je=e,De||((De=document.createElement("input")).style.display="none",De.type="file",De.addEventListener("change",Be),(t=t||document.body).appendChild(De)),Ge(De)},et=function(e,t){var n=0|e,r=n%60,o=(n/60|0)%60+":"+(r/100).toFixed(2).substring(2);return e%1>0&&("frames"===t?o=r+"+"+(e%1*60).toFixed(0)+"f":o+=(e%1).toFixed(2).substring(1)),o},tt=function(e,t){var n,r,o=e.values;for(n=0,r=o.length;n<r;n++){var i=o[n];if(i.time===t)return{index:n,object:i};if(i.time>t)return n}return n},nt=function(e,t){var n,r,o,i,a=e.values;if(0!==(r=a.length)&&!e._mute){if(t<(o=a[0]).time)return{value:o.value,can_tween:!1,keyframe:!1};for(n=0;n<r;n++){if(i=o,t===(o=a[n]).time)return n===r-1?{entry:i,tween:i.tween,can_tween:r>1,value:o.value,keyframe:!0}:{entry:o,tween:o.tween,can_tween:r>1,value:o.value,keyframe:!0};if(t<o.time){if(!i.tween)return{value:i.value,tween:!1,entry:i,can_tween:!0,keyframe:!1};var s=o.time-i.time,l=o.value-i.value,c=i.tween,u=(t-i.time)/s;return{entry:i,value:i.value+Ye[c](u)*l,tween:i.tween,can_tween:!0,keyframe:!1}}}return{value:o.value,can_tween:!1,keyframe:!1}}},rt=function(e){var t={};function n(n){return function(){return e[n].apply(e,arguments),t}}function r(n){return function(r){return e[n]=r,t}}for(var i in t.run=function(e){return e(t),t},e)switch(o(e[i])){case"object":break;case"function":t[i]=n(i);break;default:t[i]=r(i)}return t},ot=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.listeners=new Set}var n,r;return n=e,r=[{key:"do",value:function(e){this.listeners.add(e)}},{key:"undo",value:function(e){this.listeners.delete(e)}},{key:"fire",value:function(){var e,t=i(this.listeners);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.apply(void 0,arguments)}}catch(e){t.e(e)}finally{t.f()}}}],r&&t(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),e}();function it(e,t,n,r,o){var i=null,a=e.getBoundingClientRect();function s(e){c(e),n(i)}function l(t){a=e.getBoundingClientRect();var n=t.clientX,r=t.clientY;i={startx:n,starty:r,x:n,y:r,dx:0,dy:0,offsetx:n-a.left,offsety:r-a.top,moved:!1}}function c(t){a=e.getBoundingClientRect();var n=t.clientX,r=t.clientY,o=n-a.left,s=r-a.top;i.x=n,i.y=r,i.dx=t.clientX-i.startx,i.dy=t.clientY-i.starty,i.offsetx=o,i.offsety=s,i.moved=i.moved||0!==i.dx||0!==i.dy}function u(e){c(e),r(i),i=null,document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",u)}function d(e){s(e.touches[0])}function h(t){u(t),e.removeEventListener("touchmove",d),e.removeEventListener("touchend",h)}e.addEventListener("mousedown",(function(e){l(e),!o||o(i)?(document.addEventListener("mousemove",s),document.addEventListener("mouseup",u),t(i),e.preventDefault()):i=null})),e.addEventListener("touchstart",(function(n){if(1==n.touches.length){var r=n.touches[0];if(o&&!o(r))return;n.preventDefault(),l(r),t(i)}e.addEventListener("touchmove",d),e.addEventListener("touchend",h)}))}var at=Xe,st=Ke;function lt(e){var t=void 0===(e=e||{}).min?-1/0:e.min,n=at(e.xstep,e.step,.001),r=at(e.ystep,e.step,.1),o=at(e.wheelStep,r),i=at(e.wheelStepFine,n),a=e.precision||3,s=document.createElement("input");st(s,{textAlign:"center",fontSize:"10px",padding:"1px",cursor:"ns-resize",width:"40px",margin:0,marginRight:"10px",appearance:"none",outline:"none",border:0,background:"none",borderBottom:"1px dotted "+We,color:We});var l,c=this,u=0;function d(e){return Math.max(t,e)}function h(){c.onChange.fire(u)}this.onChange=new ot,s.addEventListener("change",(function(e){console.log("input changed",s.value),u=parseFloat(s.value,10),h()})),s.addEventListener("keydown",(function(e){e.stopPropagation()})),s.addEventListener("focus",(function(e){s.setSelectionRange(0,s.value.length)})),s.addEventListener("wheel",(function(e){var t=e.deltaY>0?1:-1;e.altKey?t*=i:t*=o,u=d(u+t),h()})),it(s,(function(e){l=u}),(function(e){var t=e.dx,o=e.dy;u=d(u=l+t*n+o*-r),c.onChange.fire(u,!0)}),(function(e){e.moved?h():s.focus()})),this.dom=s,this.setValue=function(e){u=e,s.value=u.toFixed(a)},this.paint=function(){u&&document.activeElement!==s&&(s.value=u.toFixed(a))}}function ct(e,t){var n=document.createElement("div"),r=document.createElement("span");r.style.cssText="font-size: 12px; padding: 4px;",r.addEventListener("click",(function(e){})),r.addEventListener("mouseover",(function(e){}));var o,i=document.createElement("select");for(var a in i.style.cssText="font-size: 10px; width: 60px; margin: 0; float: right; text-align: right;",Ye)(o=document.createElement("option")).text=a,i.appendChild(o);i.addEventListener("change",(function(n){t.fire("ease",e,i.value)}));var s,l=Ze.LINE_HEIGHT-1,c=document.createElement("button");function u(n){i.style.opacity=0,i.disabled=!0,c.style.color=ze;var r=nt(e,n);r&&(r.can_tween&&(i.style.opacity=1,i.disabled=!1,i.value=r.tween?r.tween:"none","none"===i.value&&(i.style.opacity=.5)),r.keyframe&&(c.style.color=We),s.get("_value").value=r.value,t.fire("target.notify",e.name,r.value))}c.innerHTML="&#9672;",c.style.cssText="background: none; font-size: 12px; padding: 0px; font-family: monospace; float: right; width: 20px; height: "+l+"px; border-style:none; outline: none;",c.addEventListener("click",(function(n){console.log("clicked:keyframing...",s.get("_value").value),t.fire("keyframe",e,s.get("_value").value)})),n.appendChild(r),Ke(n,{textAlign:"left",margin:"0px 0px 0px 5px",borderBottom:"1px solid "+ze,top:0,left:0,height:Ze.LINE_HEIGHT-1+"px",color:We}),this.dom=n,this.repaint=u,this.setState=function(t,n){e=t;var o=(s=n).get("_value");void 0===o.value&&(o.value=0),r.textContent=s.get("name").value,u()}}var ut={unitsPerEm:1792,ascender:1536,descender:-256,fonts:{plus:{advanceWidth:1408,commands:"M,1408,800 C,1408,853,1365,896,1312,896 L,896,896 L,896,1312 C,896,1365,853,1408,800,1408 L,608,1408 C,555,1408,512,1365,512,1312 L,512,896 L,96,896 C,43,896,0,853,0,800 L,0,608 C,0,555,43,512,96,512 L,512,512 L,512,96 C,512,43,555,0,608,0 L,800,0 C,853,0,896,43,896,96 L,896,512 L,1312,512 C,1365,512,1408,555,1408,608 Z"},minus:{advanceWidth:1408,commands:"M,1408,800 C,1408,853,1365,896,1312,896 L,96,896 C,43,896,0,853,0,800 L,0,608 C,0,555,43,512,96,512 L,1312,512 C,1365,512,1408,555,1408,608 Z"},ok:{advanceWidth:1792,commands:"M,1671,970 C,1671,995,1661,1020,1643,1038 L,1507,1174 C,1489,1192,1464,1202,1439,1202 C,1414,1202,1389,1192,1371,1174 L,715,517 L,421,812 C,403,830,378,840,353,840 C,328,840,303,830,285,812 L,149,676 C,131,658,121,633,121,608 C,121,583,131,558,149,540 L,511,178 L,647,42 C,665,24,690,14,715,14 C,740,14,765,24,783,42 L,919,178 L,1643,902 C,1661,920,1671,945,1671,970 Z"},remove:{advanceWidth:1408,commands:"M,1298,214 C,1298,239,1288,264,1270,282 L,976,576 L,1270,870 C,1288,888,1298,913,1298,938 C,1298,963,1288,988,1270,1006 L,1134,1142 C,1116,1160,1091,1170,1066,1170 C,1041,1170,1016,1160,998,1142 L,704,848 L,410,1142 C,392,1160,367,1170,342,1170 C,317,1170,292,1160,274,1142 L,138,1006 C,120,988,110,963,110,938 C,110,913,120,888,138,870 L,432,576 L,138,282 C,120,264,110,239,110,214 C,110,189,120,164,138,146 L,274,10 C,292,-8,317,-18,342,-18 C,367,-18,392,-8,410,10 L,704,304 L,998,10 C,1016,-8,1041,-18,1066,-18 C,1091,-18,1116,-8,1134,10 L,1270,146 C,1288,164,1298,189,1298,214 Z"},zoom_in:{advanceWidth:1664,commands:"M,1024,736 C,1024,753,1009,768,992,768 L,768,768 L,768,992 C,768,1009,753,1024,736,1024 L,672,1024 C,655,1024,640,1009,640,992 L,640,768 L,416,768 C,399,768,384,753,384,736 L,384,672 C,384,655,399,640,416,640 L,640,640 L,640,416 C,640,399,655,384,672,384 L,736,384 C,753,384,768,399,768,416 L,768,640 L,992,640 C,1009,640,1024,655,1024,672 M,1152,704 C,1152,457,951,256,704,256 C,457,256,256,457,256,704 C,256,951,457,1152,704,1152 C,951,1152,1152,951,1152,704 M,1664,-128 C,1664,-94,1650,-61,1627,-38 L,1284,305 C,1365,422,1408,562,1408,704 C,1408,1093,1093,1408,704,1408 C,315,1408,0,1093,0,704 C,0,315,315,0,704,0 C,846,0,986,43,1103,124 L,1446,-218 C,1469,-242,1502,-256,1536,-256 C,1607,-256,1664,-199,1664,-128 Z"},zoom_out:{advanceWidth:1664,commands:"M,1024,736 C,1024,753,1009,768,992,768 L,416,768 C,399,768,384,753,384,736 L,384,672 C,384,655,399,640,416,640 L,992,640 C,1009,640,1024,655,1024,672 M,1152,704 C,1152,457,951,256,704,256 C,457,256,256,457,256,704 C,256,951,457,1152,704,1152 C,951,1152,1152,951,1152,704 M,1664,-128 C,1664,-94,1650,-61,1627,-38 L,1284,305 C,1365,422,1408,562,1408,704 C,1408,1093,1093,1408,704,1408 C,315,1408,0,1093,0,704 C,0,315,315,0,704,0 C,846,0,986,43,1103,124 L,1446,-218 C,1469,-242,1502,-256,1536,-256 C,1607,-256,1664,-199,1664,-128 Z"},cog:{advanceWidth:1536,commands:"M,1024,640 C,1024,499,909,384,768,384 C,627,384,512,499,512,640 C,512,781,627,896,768,896 C,909,896,1024,781,1024,640 M,1536,749 C,1536,766,1524,782,1507,785 L,1324,813 C,1314,846,1300,879,1283,911 C,1317,958,1354,1002,1388,1048 C,1393,1055,1396,1062,1396,1071 C,1396,1079,1394,1087,1389,1093 C,1347,1152,1277,1214,1224,1263 C,1217,1269,1208,1273,1199,1273 C,1190,1273,1181,1270,1175,1264 L,1033,1157 C,1004,1172,974,1184,943,1194 L,915,1378 C,913,1395,897,1408,879,1408 L,657,1408 C,639,1408,625,1396,621,1380 C,605,1320,599,1255,592,1194 C,561,1184,530,1171,501,1156 L,363,1263 C,355,1269,346,1273,337,1273 C,303,1273,168,1127,144,1094 C,139,1087,135,1080,135,1071 C,135,1062,139,1054,145,1047 C,182,1002,218,957,252,909 C,236,879,223,849,213,817 L,27,789 C,12,786,0,768,0,753 L,0,531 C,0,514,12,498,29,495 L,212,468 C,222,434,236,401,253,369 C,219,322,182,278,148,232 C,143,225,140,218,140,209 C,140,201,142,193,147,186 C,189,128,259,66,312,18 C,319,11,328,7,337,7 C,346,7,355,10,362,16 L,503,123 C,532,108,562,96,593,86 L,621,-98 C,623,-115,639,-128,657,-128 L,879,-128 C,897,-128,911,-116,915,-100 C,931,-40,937,25,944,86 C,975,96,1006,109,1035,124 L,1173,16 C,1181,11,1190,7,1199,7 C,1233,7,1368,154,1392,186 C,1398,193,1401,200,1401,209 C,1401,218,1397,227,1391,234 C,1354,279,1318,323,1284,372 C,1300,401,1312,431,1323,463 L,1508,491 C,1524,494,1536,512,1536,527 Z"},trash:{advanceWidth:1408,commands:"M,512,800 C,512,818,498,832,480,832 L,416,832 C,398,832,384,818,384,800 L,384,224 C,384,206,398,192,416,192 L,480,192 C,498,192,512,206,512,224 M,768,800 C,768,818,754,832,736,832 L,672,832 C,654,832,640,818,640,800 L,640,224 C,640,206,654,192,672,192 L,736,192 C,754,192,768,206,768,224 M,1024,800 C,1024,818,1010,832,992,832 L,928,832 C,910,832,896,818,896,800 L,896,224 C,896,206,910,192,928,192 L,992,192 C,1010,192,1024,206,1024,224 M,1152,76 C,1152,28,1125,0,1120,0 L,288,0 C,283,0,256,28,256,76 L,256,1024 L,1152,1024 L,1152,76 M,480,1152 L,529,1269 C,532,1273,540,1279,546,1280 L,863,1280 C,868,1279,877,1273,880,1269 L,928,1152 M,1408,1120 C,1408,1138,1394,1152,1376,1152 L,1067,1152 L,997,1319 C,977,1368,917,1408,864,1408 L,544,1408 C,491,1408,431,1368,411,1319 L,341,1152 L,32,1152 C,14,1152,0,1138,0,1120 L,0,1056 C,0,1038,14,1024,32,1024 L,128,1024 L,128,72 C,128,-38,200,-128,288,-128 L,1120,-128 C,1208,-128,1280,-34,1280,76 L,1280,1024 L,1376,1024 C,1394,1024,1408,1038,1408,1056 Z"},file_alt:{advanceWidth:1536,commands:"M,1468,1156 L,1156,1468 C,1119,1505,1045,1536,992,1536 L,96,1536 C,43,1536,0,1493,0,1440 L,0,-160 C,0,-213,43,-256,96,-256 L,1440,-256 C,1493,-256,1536,-213,1536,-160 L,1536,992 C,1536,1045,1505,1119,1468,1156 M,1024,1400 C,1041,1394,1058,1385,1065,1378 L,1378,1065 C,1385,1058,1394,1041,1400,1024 L,1024,1024 M,1408,-128 L,128,-128 L,128,1408 L,896,1408 L,896,992 C,896,939,939,896,992,896 L,1408,896 Z"},download_alt:{advanceWidth:1664,commands:"M,1280,192 C,1280,157,1251,128,1216,128 C,1181,128,1152,157,1152,192 C,1152,227,1181,256,1216,256 C,1251,256,1280,227,1280,192 M,1536,192 C,1536,157,1507,128,1472,128 C,1437,128,1408,157,1408,192 C,1408,227,1437,256,1472,256 C,1507,256,1536,227,1536,192 M,1664,416 C,1664,469,1621,512,1568,512 L,1104,512 L,968,376 C,931,340,883,320,832,320 C,781,320,733,340,696,376 L,561,512 L,96,512 C,43,512,0,469,0,416 L,0,96 C,0,43,43,0,96,0 L,1568,0 C,1621,0,1664,43,1664,96 M,1339,985 C,1329,1008,1306,1024,1280,1024 L,1024,1024 L,1024,1472 C,1024,1507,995,1536,960,1536 L,704,1536 C,669,1536,640,1507,640,1472 L,640,1024 L,384,1024 C,358,1024,335,1008,325,985 C,315,961,320,933,339,915 L,787,467 C,799,454,816,448,832,448 C,848,448,865,454,877,467 L,1325,915 C,1344,933,1349,961,1339,985 Z"},repeat:{advanceWidth:1536,commands:"M,1536,1280 C,1536,1306,1520,1329,1497,1339 C,1473,1349,1445,1344,1427,1325 L,1297,1196 C,1156,1329,965,1408,768,1408 C,345,1408,0,1063,0,640 C,0,217,345,-128,768,-128 C,997,-128,1213,-27,1359,149 C,1369,162,1369,181,1357,192 L,1220,330 C,1213,336,1204,339,1195,339 C,1186,338,1177,334,1172,327 C,1074,200,927,128,768,128 C,486,128,256,358,256,640 C,256,922,486,1152,768,1152 C,899,1152,1023,1102,1117,1015 L,979,877 C,960,859,955,831,965,808 C,975,784,998,768,1024,768 L,1472,768 C,1507,768,1536,797,1536,832 Z"},pencil:{advanceWidth:1536,commands:"M,363,0 L,256,0 L,256,128 L,128,128 L,128,235 L,219,326 L,454,91 M,886,928 C,886,922,884,916,879,911 L,337,369 C,332,364,326,362,320,362 C,307,362,298,371,298,384 C,298,390,300,396,305,401 L,847,943 C,852,948,858,950,864,950 C,877,950,886,941,886,928 M,832,1120 L,0,288 L,0,-128 L,416,-128 L,1248,704 M,1515,1024 C,1515,1058,1501,1091,1478,1115 L,1243,1349 C,1219,1373,1186,1387,1152,1387 C,1118,1387,1085,1373,1062,1349 L,896,1184 L,1312,768 L,1478,934 C,1501,957,1515,990,1515,1024 Z"},edit:{advanceWidth:1792,commands:"M,888,352 L,832,352 L,832,448 L,736,448 L,736,504 L,852,620 L,1004,468 M,1328,1072 C,1337,1063,1336,1048,1327,1039 L,977,689 C,968,680,953,679,944,688 C,935,697,936,712,945,721 L,1295,1071 C,1304,1080,1319,1081,1328,1072 M,1408,478 C,1408,491,1400,502,1388,507 C,1376,512,1363,510,1353,500 L,1289,436 C,1283,430,1280,422,1280,414 L,1280,288 C,1280,200,1208,128,1120,128 L,288,128 C,200,128,128,200,128,288 L,128,1120 C,128,1208,200,1280,288,1280 L,1120,1280 C,1135,1280,1150,1278,1165,1274 C,1176,1270,1188,1273,1197,1282 L,1246,1331 C,1254,1339,1257,1349,1255,1360 C,1253,1370,1246,1379,1237,1383 C,1200,1400,1160,1408,1120,1408 L,288,1408 C,129,1408,0,1279,0,1120 L,0,288 C,0,129,129,0,288,0 L,1120,0 C,1279,0,1408,129,1408,288 M,1312,1216 L,640,544 L,640,256 L,928,256 L,1600,928 M,1756,1084 C,1793,1121,1793,1183,1756,1220 L,1604,1372 C,1567,1409,1505,1409,1468,1372 L,1376,1280 L,1664,992 L,1756,1084 Z"},play:{advanceWidth:1408,commands:"M,1384,609 C,1415,626,1415,654,1384,671 L,56,1409 C,25,1426,0,1411,0,1376 L,0,-96 C,0,-131,25,-146,56,-129 Z"},pause:{advanceWidth:1536,commands:"M,1536,1344 C,1536,1379,1507,1408,1472,1408 L,960,1408 C,925,1408,896,1379,896,1344 L,896,-64 C,896,-99,925,-128,960,-128 L,1472,-128 C,1507,-128,1536,-99,1536,-64 M,640,1344 C,640,1379,611,1408,576,1408 L,64,1408 C,29,1408,0,1379,0,1344 L,0,-64 C,0,-99,29,-128,64,-128 L,576,-128 C,611,-128,640,-99,640,-64 Z"},stop:{advanceWidth:1536,commands:"M,1536,1344 C,1536,1379,1507,1408,1472,1408 L,64,1408 C,29,1408,0,1379,0,1344 L,0,-64 C,0,-99,29,-128,64,-128 L,1472,-128 C,1507,-128,1536,-99,1536,-64 Z"},resize_full:{advanceWidth:1536,commands:"M,755,480 C,755,488,751,497,745,503 L,631,617 C,625,623,616,627,608,627 C,600,627,591,623,585,617 L,253,285 L,109,429 C,97,441,81,448,64,448 C,29,448,0,419,0,384 L,0,-64 C,0,-99,29,-128,64,-128 L,512,-128 C,547,-128,576,-99,576,-64 C,576,-47,569,-31,557,-19 L,413,125 L,745,457 C,751,463,755,472,755,480 M,1536,1344 C,1536,1379,1507,1408,1472,1408 L,1024,1408 C,989,1408,960,1379,960,1344 C,960,1327,967,1311,979,1299 L,1123,1155 L,791,823 C,785,817,781,808,781,800 C,781,792,785,783,791,777 L,905,663 C,911,657,920,653,928,653 C,936,653,945,657,951,663 L,1283,995 L,1427,851 C,1439,839,1455,832,1472,832 C,1507,832,1536,861,1536,896 Z"},resize_small:{advanceWidth:1536,commands:"M,768,576 C,768,611,739,640,704,640 L,256,640 C,221,640,192,611,192,576 C,192,559,199,543,211,531 L,355,387 L,23,55 C,17,49,13,40,13,32 C,13,24,17,15,23,9 L,137,-105 C,143,-111,152,-115,160,-115 C,168,-115,177,-111,183,-105 L,515,227 L,659,83 C,671,71,687,64,704,64 C,739,64,768,93,768,128 M,1523,1248 C,1523,1256,1519,1265,1513,1271 L,1399,1385 C,1393,1391,1384,1395,1376,1395 C,1368,1395,1359,1391,1353,1385 L,1021,1053 L,877,1197 C,865,1209,849,1216,832,1216 C,797,1216,768,1187,768,1152 L,768,704 C,768,669,797,640,832,640 L,1280,640 C,1315,640,1344,669,1344,704 C,1344,721,1337,737,1325,749 L,1181,893 L,1513,1225 C,1519,1231,1523,1240,1523,1248 Z"},eye_open:{advanceWidth:1792,commands:"M,1664,576 C,1493,312,1217,128,896,128 C,575,128,299,312,128,576 C,223,723,353,849,509,929 C,469,861,448,783,448,704 C,448,457,649,256,896,256 C,1143,256,1344,457,1344,704 C,1344,783,1323,861,1283,929 C,1439,849,1569,723,1664,576 M,944,960 C,944,934,922,912,896,912 C,782,912,688,818,688,704 C,688,678,666,656,640,656 C,614,656,592,678,592,704 C,592,871,729,1008,896,1008 C,922,1008,944,986,944,960 M,1792,576 C,1792,601,1784,624,1772,645 C,1588,947,1251,1152,896,1152 C,541,1152,204,947,20,645 C,8,624,0,601,0,576 C,0,551,8,528,20,507 C,204,205,541,0,896,0 C,1251,0,1588,204,1772,507 C,1784,528,1792,551,1792,576 Z"},eye_close:{advanceWidth:1792,commands:"M,555,201 C,379,280,232,415,128,576 C,223,723,353,849,509,929 C,469,861,448,783,448,704 C,448,561,517,426,633,342 M,944,960 C,944,934,922,912,896,912 C,782,912,688,819,688,704 C,688,678,666,656,640,656 C,614,656,592,678,592,704 C,592,871,729,1008,896,1008 C,922,1008,944,986,944,960 M,1307,1151 C,1307,1162,1301,1172,1291,1178 C,1270,1190,1176,1248,1158,1248 C,1146,1248,1136,1242,1130,1232 L,1076,1135 C,1017,1146,956,1152,896,1152 C,527,1152,218,949,20,645 C,7,625,0,600,0,576 C,0,551,7,527,20,507 C,135,327,298,177,492,89 C,482,72,448,18,448,2 C,448,-10,454,-20,464,-26 C,485,-38,580,-96,598,-96 C,609,-96,620,-90,626,-80 L,675,9 C,886,386,1095,765,1306,1142 C,1307,1144,1307,1149,1307,1151 M,1344,704 C,1344,732,1341,760,1336,788 L,1056,286 C,1229,352,1344,518,1344,704 M,1792,576 C,1792,602,1785,623,1772,645 C,1694,774,1569,899,1445,982 L,1382,870 C,1495,792,1590,691,1664,576 C,1508,334,1261,157,970,132 L,896,0 C,1197,0,1467,137,1663,362 C,1702,407,1741,456,1772,507 C,1785,529,1792,550,1792,576 Z"},folder_open:{advanceWidth:1920,commands:"M,1879,584 C,1879,629,1828,640,1792,640 L,704,640 C,616,640,498,586,440,518 L,104,122 C,88,104,73,80,73,56 C,73,11,124,0,160,0 L,1248,0 C,1336,0,1454,54,1512,122 L,1848,518 C,1864,536,1879,560,1879,584 M,1536,928 C,1536,1051,1435,1152,1312,1152 L,768,1152 L,768,1184 C,768,1307,667,1408,544,1408 L,224,1408 C,101,1408,0,1307,0,1184 L,0,224 C,0,216,1,207,1,199 L,6,205 L,343,601 C,424,697,579,768,704,768 L,1536,768 Z"},signin:{advanceWidth:1536,commands:"M,1184,640 C,1184,657,1177,673,1165,685 L,621,1229 C,609,1241,593,1248,576,1248 C,541,1248,512,1219,512,1184 L,512,896 L,64,896 C,29,896,0,867,0,832 L,0,448 C,0,413,29,384,64,384 L,512,384 L,512,96 C,512,61,541,32,576,32 C,593,32,609,39,621,51 L,1165,595 C,1177,607,1184,623,1184,640 M,1536,992 C,1536,1151,1407,1280,1248,1280 L,928,1280 C,883,1280,896,1212,896,1184 C,896,1147,935,1152,960,1152 L,1248,1152 C,1336,1152,1408,1080,1408,992 L,1408,288 C,1408,200,1336,128,1248,128 L,928,128 C,883,128,896,60,896,32 C,896,15,911,0,928,0 L,1248,0 C,1407,0,1536,129,1536,288 Z"},upload_alt:{advanceWidth:1664,commands:"M,1280,64 C,1280,29,1251,0,1216,0 C,1181,0,1152,29,1152,64 C,1152,99,1181,128,1216,128 C,1251,128,1280,99,1280,64 M,1536,64 C,1536,29,1507,0,1472,0 C,1437,0,1408,29,1408,64 C,1408,99,1437,128,1472,128 C,1507,128,1536,99,1536,64 M,1664,288 C,1664,341,1621,384,1568,384 L,1141,384 C,1114,310,1043,256,960,256 L,704,256 C,621,256,550,310,523,384 L,96,384 C,43,384,0,341,0,288 L,0,-32 C,0,-85,43,-128,96,-128 L,1568,-128 C,1621,-128,1664,-85,1664,-32 M,1339,936 C,1349,959,1344,987,1325,1005 L,877,1453 C,865,1466,848,1472,832,1472 C,816,1472,799,1466,787,1453 L,339,1005 C,320,987,315,959,325,936 C,335,912,358,896,384,896 L,640,896 L,640,448 C,640,413,669,384,704,384 L,960,384 C,995,384,1024,413,1024,448 L,1024,896 L,1280,896 C,1306,896,1329,912,1339,936 Z"},save:{advanceWidth:1536,commands:"M,384,0 L,384,384 L,1152,384 L,1152,0 M,1280,0 L,1280,416 C,1280,469,1237,512,1184,512 L,352,512 C,299,512,256,469,256,416 L,256,0 L,128,0 L,128,1280 L,256,1280 L,256,864 C,256,811,299,768,352,768 L,928,768 C,981,768,1024,811,1024,864 L,1024,1280 C,1044,1280,1083,1264,1097,1250 L,1378,969 C,1391,956,1408,915,1408,896 L,1408,0 M,896,928 C,896,911,881,896,864,896 L,672,896 C,655,896,640,911,640,928 L,640,1248 C,640,1265,655,1280,672,1280 L,864,1280 C,881,1280,896,1265,896,1248 L,896,928 M,1536,896 C,1536,949,1506,1022,1468,1060 L,1188,1340 C,1150,1378,1077,1408,1024,1408 L,96,1408 C,43,1408,0,1365,0,1312 L,0,-32 C,0,-85,43,-128,96,-128 L,1440,-128 C,1493,-128,1536,-85,1536,-32 Z"},undo:{advanceWidth:1536,commands:"M,1536,640 C,1536,1063,1191,1408,768,1408 C,571,1408,380,1329,239,1196 L,109,1325 C,91,1344,63,1349,40,1339 C,16,1329,0,1306,0,1280 L,0,832 C,0,797,29,768,64,768 L,512,768 C,538,768,561,784,571,808 C,581,831,576,859,557,877 L,420,1015 C,513,1102,637,1152,768,1152 C,1050,1152,1280,922,1280,640 C,1280,358,1050,128,768,128 C,609,128,462,200,364,327 C,359,334,350,338,341,339 C,332,339,323,336,316,330 L,179,192 C,168,181,167,162,177,149 C,323,-27,539,-128,768,-128 C,1191,-128,1536,217,1536,640 Z"},paste:{advanceWidth:1792,commands:"M,768,-128 L,768,1024 L,1152,1024 L,1152,608 C,1152,555,1195,512,1248,512 L,1664,512 L,1664,-128 M,1024,1312 C,1024,1295,1009,1280,992,1280 L,288,1280 C,271,1280,256,1295,256,1312 L,256,1376 C,256,1393,271,1408,288,1408 L,992,1408 C,1009,1408,1024,1393,1024,1376 L,1024,1312 M,1280,640 L,1280,939 L,1579,640 M,1792,512 C,1792,565,1762,638,1724,676 L,1316,1084 C,1305,1095,1293,1104,1280,1112 L,1280,1440 C,1280,1493,1237,1536,1184,1536 L,96,1536 C,43,1536,0,1493,0,1440 L,0,96 C,0,43,43,0,96,0 L,640,0 L,640,-160 C,640,-213,683,-256,736,-256 L,1696,-256 C,1749,-256,1792,-213,1792,-160 Z"},folder_open_alt:{advanceWidth:1920,commands:"M,1781,605 C,1781,590,1772,577,1763,566 L,1469,203 C,1435,161,1365,128,1312,128 L,224,128 C,202,128,171,135,171,163 C,171,178,180,191,189,203 L,483,566 C,517,607,587,640,640,640 L,1728,640 C,1750,640,1781,633,1781,605 M,640,768 C,549,768,442,717,384,646 L,128,331 L,128,1184 C,128,1237,171,1280,224,1280 L,544,1280 C,597,1280,640,1237,640,1184 L,640,1120 C,640,1067,683,1024,736,1024 L,1312,1024 C,1365,1024,1408,981,1408,928 L,1408,768 M,1909,605 C,1909,629,1904,652,1894,673 C,1864,737,1796,768,1728,768 L,1536,768 L,1536,928 C,1536,1051,1435,1152,1312,1152 L,768,1152 L,768,1184 C,768,1307,667,1408,544,1408 L,224,1408 C,101,1408,0,1307,0,1184 L,0,224 C,0,101,101,0,224,0 L,1312,0 C,1402,0,1511,52,1568,122 L,1863,485 C,1890,519,1909,561,1909,605 Z"}}},dt=Ke;function ht(e,t,n,r){var o=document.createElement("button");dt(o,{padding:"0.2em 0.4em",margin:"0em",background:"none",outline:"none",fontSize:"16px",border:"none",borderRadius:"0.2em"});var i=document.createElement("canvas"),a=i.getContext("2d");o.appendChild(i),this.ctx=a,this.dom=o,this.canvas=i;var s=this;this.size=e;var l,c=1;this.resize=function(){c=window.devicePixelRatio;var n=e,r=ut.fonts[t];i.height=n*c,i.style.height=n+"px";var o=n/ut.unitsPerEm,l=r.advanceWidth*o+.5|0;l+=2,n+=2,i.width=l*c,i.style.width=l+"px",a.fillStyle=We,s.draw()},r&&r.on("resize",this.resize),this.setSize=function(t){e=t,this.resize()},this.setIcon=function(e){s.icon=e,ut.fonts[e]||console.warn("Font icon not found!"),this.resize()},this.onClick=function(e){o.addEventListener("click",e)},this.onLongHold=function(e){function t(t){t.preventDefault(),t.stopPropagation(),l=setTimeout((function(){l&&(console.log("LONG HOLD-ED!"),e())}),500)}function n(){clearTimeout(l)}o.addEventListener("mousedown",t),o.addEventListener("touchstart",t),o.addEventListener("mouseup",n),o.addEventListener("mouseout",n),o.addEventListener("touchend",n)},this.setTip=function(e){n=e};var u={border:"1px solid "+ze},d={border:"1px solid transparent"},h="none",f=ze;o.style.background=h,dt(o,d),o.addEventListener("mouseover",(function(){dt(o,u),a.fillStyle=Je,a.shadowColor=ze,a.shadowBlur=.5*c,a.shadowOffsetX=1*c,a.shadowOffsetY=1*c,s.draw(),n&&r&&r.fire("status","button: "+n)})),o.addEventListener("mousedown",(function(){o.style.background=f})),o.addEventListener("mouseup",(function(){o.style.background=h,dt(o,u)})),o.addEventListener("mouseout",(function(){o.style.background=h,dt(o,d),s.dropshadow=!1,a.fillStyle=We,a.shadowColor=null,a.shadowBlur=0,a.shadowOffsetX=0,a.shadowOffsetY=0,s.draw()})),t&&this.setIcon(t)}ht.prototype.CMD_MAP={M:"moveTo",L:"lineTo",Q:"quadraticCurveTo",C:"bezierCurveTo",Z:"closePath"},ht.prototype.draw=function(){if(this.icon){var e=this.ctx,t=ut.fonts[this.icon],n=this.size,r=window.devicePixelRatio,o=n/ut.unitsPerEm*r,i=t.commands.split(" ");if(e.save(),e.clearRect(0,0,this.canvas.width*r,this.canvas.height*r),this.dropshadow){e.save(),e.fillStyle=ze,e.translate(1.5*r,1.5*r),e.scale(o,-o),e.translate(0,-ut.ascender),e.beginPath();for(var a=0,s=i.length;a<s;a++){var l=i[a].split(","),c=l.slice(1);e[this.CMD_MAP[l[0]]].apply(e,c)}e.fill(),e.restore()}e.scale(o,-o),e.translate(0,-ut.ascender),e.beginPath();for(var u=0,d=i.length;u<d;u++){var h=i[u].split(","),f=h.slice(1);e[this.CMD_MAP[h[0]]].apply(e,f)}e.fill(),e.restore()}};var ft=Ke;function vt(e,t){var n=e.get("layers"),r=document.createElement("div"),o=document.createElement("div");o.style.cssText="margin: 0px; top: 0; left: 0; height: "+Ze.MARKER_TRACK_HEIGHT+"px";var i=document.createElement("div");ft(i,{position:"absolute",top:Ze.MARKER_TRACK_HEIGHT+"px",left:0,right:0,bottom:0,overflow:"hidden"}),i.id="layer_scroll",r.appendChild(i);var a={width:"22px",height:"22px",padding:"2px"},s=new ht(16,"play","play",t);ft(s.dom,a,{marginTop:"2px"}),s.onClick((function(e){e.preventDefault(),t.fire("controls.toggle_play")}));var l=new ht(16,"stop","stop",t);ft(l.dom,a,{marginTop:"2px"}),l.onClick((function(e){t.fire("controls.stop")}));var c=document.createElement("input");c.type="range",c.value=0,c.min=-1,c.max=1,c.step=.125,ft(c,{width:"90px",margin:"0px",marginLeft:"2px",marginRight:"2px"});var u=0;c.addEventListener("mousedown",(function(){u=1})),c.addEventListener("mouseup",(function(){u=0,y()})),c.addEventListener("mousemove",(function(){u&&y()})),r.appendChild(o);var d={min:0,step:.125},h=new lt(d),f=new lt(d),v=e.get("ui:currentTime"),p=e.get("ui:totalTime");h.onChange.do((function(e,n){t.fire("time.update",e)})),f.onChange.do((function(e,t){p.value=e,L()})),o.appendChild(h.dom),o.appendChild(document.createTextNode("/")),o.appendChild(f.dom),o.appendChild(s.dom),o.appendChild(l.dom),o.appendChild(c);var g=document.createElement("div");ft(g,{marginTop:"4px"}),o.appendChild(g);var m=document.createElement("span");function y(){t.fire("update.scale",6*Math.pow(100,-c.value))}m.style.width="20px",m.style.display="inline-block",g.appendChild(m),g.appendChild(document.createElement("br"));var C=[],w=[];function L(e){var t;e=v.value,h.setValue(e),f.setValue(p.value),h.paint(),f.paint(),e=e||0;var r=n.value;for(t=C.length;t-- >0;)t>=r.length?(C[t].dom.style.display="none",w.push(C.pop())):(C[t].setState(r[t],n.get(t)),C[t].repaint(e));C.length}this.layers=C,this.setControlStatus=function(e){e?(s.setIcon("pause"),s.setTip("Pause")):(s.setIcon("play"),s.setTip("Play"))},this.setState=function(e){var r,o,a=(n=e).value;for(r=0;r<a.length;r++){var s;o=a[r],C[r]||(w.length?(s=w.pop()).dom.style.display="block":(s=new ct(o,t),i.appendChild(s.dom)),C.push(s))}console.log("Total layers (view, hidden, total)",C.length,w.length,C.length+w.length)},this.repaint=L,this.setState(n),this.scrollTo=function(e){i.scrollTop=e*(i.scrollHeight-i.clientHeight)},this.dom=r,L()}function pt(){}function gt(e,t){var n,r;this.setSize=function(e,t){n=e,r=t};var o={left:0,grip_length:0,k:1},i=new pt;this.paint=function(e){var a=t.get("ui:totalTime").value,s=t.get("ui:scrollTime").value,l=t.get("ui:currentTime").value,c=t.get("ui:timeScale").value;e.save();var u=window.devicePixelRatio;e.scale(u,u);var d=n-30;e.clearRect(0,0,n,r),e.translate(15,5),e.beginPath(),e.strokeStyle=ze,e.rect(0,0,d,16),e.stroke();var h=d/(a*c);o.k=h;var f=d*h;o.grip_length=f,o.left=s/a*d,i.set(o.left,0,o.grip_length,16),i.paint(e);var v=l/a*d;e.fillStyle=We,e.lineWidth=2,e.beginPath(),e.rect(v,0,2,21),e.fill(),e.fillText(l&&l.toFixed(2),v,30),e.fillText(a,300,14),e.restore()};var a=null;this.onDown=function(r){if(i.contains(r.offsetx-15,r.offsety-5))a=o.left;else{var s=t.get("ui:totalTime").value;t.get("ui:timeScale").value;var l=n-30,c=(r.offsetx-15)/l*s;e.fire("time.update",c),r.preventDefault&&r.preventDefault()}},this.onMove=function(r){if(null!=a){var i=t.get("ui:totalTime").value,s=n-30,l=(a+r.dx)/s*i;if(a+r.dx+o.grip_length>s)return;e.fire("update.scrollTime",l)}else this.onDown(r)},this.onUp=function(e){a=null}}function mt(e,t){var n,r,o,i,a,s,l=[];function c(e,t){o=e,i=t,a=window.devicePixelRatio,n.width=o*a,n.height=i*a,n.style.width=o+"px",n.style.height=i+"px",s&&s.setSize(e,t)}n=document.createElement("canvas"),r=n.getContext("2d"),c(e,t),this.setSize=c,this.repaint=function(){!function(e){s&&(s.paint||console.warn("implement repaint()"),s.paint(e));for(var t=0;t<l.length;t++)l[t].paint()}(r)},this.uses=function(e){(s=e).add=this.add,s.remove=this.remove},this.dom=n,it(n,(function(e){s.onDown&&s.onDown(e)}),(function(e){s.onMove&&s.onMove(e)}),(function(e){s.onUp&&s.onUp(e)}))}pt.prototype.set=function(e,t,n,r,o,i){this.x=e,this.y=t,this.w=n,this.h=r,this.color=o,this.outline=i},pt.prototype.paint=function(e){e.fillStyle=ze,e.strokeStyle=We,this.shape(e),e.stroke(),e.fill()},pt.prototype.shape=function(e){e.beginPath(),e.rect(this.x,this.y,this.w,this.h)},pt.prototype.contains=function(e,t){return e>=this.x&&t>=this.y&&e<=this.x+this.w&&t<=this.y+this.h};var yt,Ct,wt,Lt=rt,bt=Ze.LINE_HEIGHT,xt=Ze.DIAMOND_SIZE,St=Ze.time_scale,_t=0;function Et(){Ct=2*(yt=St/60),wt=10*yt}function Mt(e,t){var n,r=window.devicePixelRatio,o=document.createElement("canvas"),i=0,a=e.get("layers").value;this.scrollTo=function(e,t){i=e*Math.max(a.length*bt-n,0),L()},this.resize=function(){var e=Ze.height-35;r=window.devicePixelRatio,o.width=Ze.width*r,o.height=e*r,o.style.width=Ze.width+"px",o.style.height=e+"px",n=Ze.height-35,l.setSize(Ze.width,35)};var s=document.createElement("div"),l=new mt(Ze.width,35);Ke(o,{position:"absolute",top:"35px",left:"0px"}),Ke(l.dom,{position:"absolute",top:"0px",left:"10px"}),l.uses(new gt(t,e)),s.appendChild(o),s.appendChild(l.dom),l.dom.id="scroll-canvas",o.id="track-canvas",this.dom=s,this.dom.id="timeline-panel",this.resize();var c,u,d,h,f,v=o.getContext("2d"),p=Lt(v),g=20,m=!1,y=[];function C(e,t,n,r,i,a,s,l,c){this.path=function(){p.beginPath().rect(e,t,n-e,r-t).closePath()},this.paint=function(){this.path(),v.fillStyle=i._color,v.fill()},this.mouseover=function(){o.style.cursor="pointer"},this.mouseout=function(){o.style.cursor="default"},this.mousedrag=function(t){var r=k(e+t.dx);r=Math.max(0,r),i.time=r;var o=k(n+t.dx);o=Math.max(0,o),a.time=o}}function w(e,n){var r,i;r=T(e.time),i=n+.5*bt-xt/2;var a=this,s=!1;this.path=function(e){e.beginPath().moveTo(r,i).lineTo(r+xt/2,i+xt/2).lineTo(r,i+xt).lineTo(r-xt/2,i+xt/2).closePath()},this.paint=function(e){a.path(e),s?e.fillStyle("yellow"):e.fillStyle(We),e.fill().stroke()},this.mouseover=function(){s=!0,o.style.cursor="move",a.paint(p)},this.mouseout=function(){s=!1,o.style.cursor="default",a.paint(p)},this.mousedrag=function(n){var o=k(r+n.dx);o=Math.max(0,o),e.time=o,t.fire("time.update",o)}}function L(){m=!0}function b(){for(y=[],u=0,f=a.length;u<=f;u++)v.strokeStyle=ze,v.beginPath(),h=~~(h=u*bt)-.5,p.moveTo(0,h).lineTo(Ze.width,h).stroke();var e,t,n;for(u=0;u<f;u++){var r=a[u].values;for(h=u*bt,n=0;n<r.length-1;n++){e=r[n],t=r[n+1];var o=T(e.time),i=T(t.time);if(e.tween&&"none"!=e.tween){var s=h+2,l=h+bt-2;y.push(new C(o,s,i,l,e,t))}}for(n=0;n<r.length;n++)e=r[n],y.push(new w(e,h))}for(u=0,f=y.length;u<f;u++)y[u].paint(p)}var x,S=null,_=null;function E(){var e,t=S;for(S=null,u=y.length;u-- >0;)if((e=y[u]).path(p),v.isPointInPath(q.x*r,q.y*r)){S=e;break}t&&t!=S&&(e=t).mouseout&&e.mouseout(),S&&((e=S).mouseover&&e.mouseover(),O&&(_=e))}function M(){q&&p.save().scale(r,r).translate(0,25).beginPath().rect(0,0,Ze.width,n).translate(-0,-i).clip().run(E).restore()}function k(e){return _t+((e-g)/(St/wt)|0)/wt}function T(e){var t=e-_t;return(t*=St)+g}this.repaint=L,this._paint=function(){if(m){var t;l.repaint(),t=e.get("ui:timeScale").value,St!==t&&(St=t,Et()),c=e.get("ui:currentTime").value,_t=e.get("ui:scrollTime").value,v.fillStyle=Ue,v.clearRect(0,0,o.width,o.height),v.save(),v.scale(r,r),v.lineWidth=1;var a=Ze.width,s=Ze.height,h=St/yt,f=_t*St%h,y=(a-g+f)/h;for(u=0;u<y;u++){d=u*h+g-f,v.strokeStyle=ze,v.beginPath(),v.moveTo(d,0),v.lineTo(d,s),v.stroke(),v.fillStyle=Je,v.textAlign="center";var C=(u*h-f)/St+_t;C=et(C),v.fillText(C,d,38)}for(y=(a-g+f)/(h=St/Ct),u=0;u<y;u++)v.strokeStyle=We,v.beginPath(),d=u*h+g-f,v.moveTo(d,25),v.lineTo(d,9),v.stroke();var w=wt/Ct;for(y=(a-g+f)/(h=St/wt),u=0;u<y;u++)u%w!=0&&(v.strokeStyle=We,v.beginPath(),d=u*h+g-f,v.moveTo(d,25),v.lineTo(d,15),v.stroke());p.save().translate(0,25).beginPath().rect(0,0,Ze.width,n).translate(-0,-i).clip().run(b).restore(),v.strokeStyle="red",d=(c-_t)*St+g;var L=et(c),x=v.measureText(L).width/2+4;v.beginPath(),v.moveTo(d,20),v.lineTo(d,s),v.stroke(),v.fillStyle="red",v.textAlign="center",v.beginPath(),v.moveTo(d,25),v.lineTo(d+5,20),v.lineTo(d+x,20),v.lineTo(d+x,6),v.lineTo(d-x,6),v.lineTo(d-x,20),v.lineTo(d-5,20),v.closePath(),v.fill(),v.fillStyle="white",v.fillText(L,d,16),v.restore(),m=!1}else M()},L(),document.addEventListener("mousemove",(function(e){x=o.getBoundingClientRect(),function(e,t){_||(q={x:e,y:t})}(e.clientX-x.left,e.clientY-x.top)})),o.addEventListener("dblclick",(function(e){x=o.getBoundingClientRect(),e.clientX,x.left;var n=function(e){return e-25<0?-1:(e-25+i)/bt|0}(e.clientY-x.top);t.fire("keyframe",a[n],c)}));var q=null;o.addEventListener("mouseout",(function(){q=null}));var O=!1,P=!1;it(o,(function(e){O=!0,q={x:e.offsetx,y:e.offsety},M(),_||t.fire("time.update",k(e.offsetx))}),(function(e){O=!1,_?(P=!0,_.mousedrag&&_.mousedrag(e)):t.fire("time.update",k(e.offsetx))}),(function(e){P?t.fire("keyframe.move"):t.fire("time.update",k(e.offsetx)),O=!1,_=null,P=!1})),this.setState=function(e){a=e.value,L()}}Et();var kt={position:"absolute",background:"-webkit-gradient(linear, left top, right top, color-stop(0, rgb(29,29,29)), color-stop(0.6, rgb(50,50,50)) )",border:"1px solid rgb(29, 29, 29)",textAlign:"center",cursor:"pointer"},Tt={background:"-webkit-gradient(linear, left top, right top, color-stop(0.2, rgb(88,88,88)), color-stop(0.6, rgb(64,64,64)) )",border:"1px solid rgb(25,25,25)",position:"relative",borderRadius:"6px"};function qt(e,t,n){var r=t||12,o=r+6,i=document.createElement("div");Ke(i,kt);var a=e-2;i.style.height=a+"px",i.style.width=o+"px";var s=document.createElement("div");Ke(s,Tt),s.style.width=r+"px",s.style.height=e/2,s.style.top=0,s.style.left="3px",i.appendChild(s);var l,c,u,d=this;function h(e){e.preventDefault();var t=a-l,n=(e.clientY-u)/t;n>1&&(n=1),n<0&&(n=0),d.setPosition(n),d.onScroll.fire("scrollto",n)}function f(e){h(e),document.removeEventListener("mousemove",h,!1),document.removeEventListener("mouseup",f,!1)}this.setLength=function(e){e=Math.max(Math.min(1,e),0),e*=a,l=Math.max(e,25),s.style.height=l+"px"},this.setHeight=function(t){a=(e=t)-2,i.style.height=a+"px"},this.setPosition=function(e){e=Math.max(Math.min(1,e),0),c=e*(a-l),s.style.top=c+"px"},this.setLength(1),this.setPosition(0),this.onScroll=new ot,i.addEventListener("mousedown",(function(e){e.preventDefault(),e.target==s?(u=e.clientY,document.addEventListener("mousemove",h,!1),document.addEventListener("mouseup",f,!1)):e.clientY<c?d.onScroll.fire("pageup"):e.clientY>c+l&&d.onScroll.fire("pagedown")}),!1),this.dom=i}var Ot="test-version";function Pt(){this.DELIMITER=":",this.blank(),this.onOpen=new ot,this.onSave=new ot,this.listeners=[]}function It(e,t){this.path=t,this.store=e}Pt.prototype.addListener=function(e,t){this.listeners.push({path:e,callback:t})},Pt.prototype.blank=function(){var e={};e.version=Ot,e.modified=(new Date).toString(),e.title="Untitled",e.ui={currentTime:0,totalTime:Ze.default_length,scrollTime:0,timeScale:Ze.time_scale},e.layers=[],this.data=e},Pt.prototype.update=function(){var e=this.data;e.version=Ot,e.modified=(new Date).toString()},Pt.prototype.setJSONString=function(e){this.data=JSON.parse(e)},Pt.prototype.setJSON=function(e){this.data=e},Pt.prototype.getJSONString=function(e){return JSON.stringify(this.data,null,e)},Pt.prototype.getValue=function(e){for(var t=e.split(this.DELIMITER),n=this.data,r=0,o=t.length;r<o;r++){var i=t[r];if(void 0===n[i])return void console.warn("Cant find "+e);n=n[i]}return n},Pt.prototype.setValue=function(e,t){for(var n,r=e.split(this.DELIMITER),o=this.data,i=0,a=r.length-1;n=r[i],i<a;i++)o=o[n];o[n]=t,this.listeners.forEach((function(t){e.indexOf(t.path)>-1&&t.callback()}))},Pt.prototype.get=function(e,t){return t&&(e=t+this.DELIMITER+e),new It(this,e)},It.prototype={get value(){return this.store.getValue(this.path)},set value(e){this.store.setValue(this.path,e)}},It.prototype.get=function(e){return this.store.get(e,this.path)};var Nt="full-screen",At="snap-top-edge",Rt="snap-left-edge",Ft="snap-right-edge",Ht="snap-bottom-edge";function Dt(e,t,n,r,o){e.style.left=t+"px",e.style.top=n+"px",e.style.width=r+"px",e.style.height=o+"px"}function jt(e,t){var n,r,o,i,a,s,l,c,u,d,h=null,f=!1,v=!0;function p(){return v}function g(){Dt(t,s.left,s.top,s.width,s.height),t.style.opacity=0}function m(e){y(e);var t=n||r||i||o,a=!t&&p();h={x:l,y:c,cx:e.clientX,cy:e.clientY,w:s.width,h:s.height,isResizing:t,isMoving:a,onTopEdge:i,onLeftEdge:o,onRightEdge:n,onBottomEdge:r},(t||a)&&(e.preventDefault(),e.stopPropagation())}function y(t){s=e.getBoundingClientRect(),l=t.clientX-s.left,c=t.clientY-s.top,i=c<2,o=l<2,n=l>=s.width-2,r=c>=s.height-2}function C(e){y(d=e),f=!0}function w(){return d.clientY<2?Nt:d.clientY<8?At:d.clientX<8?Rt:window.innerWidth-d.clientX<8?Ft:window.innerHeight-d.clientY<8?Ht:void 0}this.allowMove=function(e){v=e},this.maximize=function(){a?(Dt(e,s.left,s.top,s.width,s.height),y(),u=null,a=null):(a={width:s.width,height:s.height,top:s.top,left:s.left},u=Nt,S())},this.resizes=new ot;var L=this,b={};function x(e){if(e){var t,n,r,o;switch(e){case Nt:t=window.innerWidth,r=0,o=48,n=window.innerHeight-o;break;case At:t=window.innerWidth,n=window.innerHeight/2,r=0,o=0;break;case Rt:t=window.innerWidth/2,n=window.innerHeight,r=0,o=0;break;case Ft:t=window.innerWidth/2,n=window.innerHeight,r=window.innerWidth-t,o=0;break;case Ht:t=window.innerWidth,n=window.innerHeight/3,r=0,o=window.innerHeight-n;break;case"dock-bottom":t=s.width,n=s.height,r=.5*(window.innerWidth-t),o=window.innerHeight-n}Object.assign(b,{left:r,top:o,width:t,height:n})}}function S(){if(u){x(u);var t=b.left,n=b.top,r=b.width,o=b.height;Dt(e,t,n,r,o),L.resizes.fire(r,o)}}function _(e){y(e),h&&h.isMoving&&((u=w())?(a={width:s.width,height:s.height,top:s.top,left:s.left},S()):a=null,g()),h=null}window.addEventListener("resize",(function(){S()})),Dt(e,0,0,Ze.width,Ze.height),Dt(t,0,0,Ze.width,Ze.height),e.addEventListener("mousedown",(function(e){m(e)})),document.addEventListener("mousemove",C),document.addEventListener("mouseup",(function(e){_(e)})),e.addEventListener("touchstart",(function(e){m(e.touches[0]),e.preventDefault()})),document.addEventListener("touchmove",(function(e){C(e.touches[0])})),document.addEventListener("touchend",(function(e){0==e.touches.length&&_(e.changedTouches[0])})),s=e.getBoundingClientRect(),u=Nt,setTimeout((function(){return S()})),g(),function u(){if(requestAnimationFrame(u),f&&(f=!1,n&&r||o&&i?e.style.cursor="nwse-resize":n&&i||r&&o?e.style.cursor="nesw-resize":n||o?e.style.cursor="ew-resize":r||i?e.style.cursor="ns-resize":p()?e.style.cursor="move":e.style.cursor="default",h)){if(h.isResizing){if(h.onRightEdge&&(e.style.width=Math.max(l,100)+"px"),h.onBottomEdge&&(e.style.height=Math.max(c,80)+"px"),h.onLeftEdge){var v=Math.max(h.cx-d.clientX+h.w,100);v>100&&(e.style.width=v+"px",e.style.left=d.clientX+"px")}if(h.onTopEdge){var m=Math.max(h.cy-d.clientY+h.h,80);m>80&&(e.style.height=m+"px",e.style.top=d.clientY+"px")}return g(),void L.resizes.fire(s.width,s.height)}if(h.isMoving){var y=w();if(y){x(y);var C=b.left,S=b.top,_=b.width,E=b.height;Dt(t,C,S,_,E),t.style.opacity=.2}else g();return a?void Dt(e,d.clientX-a.width/2,d.clientY-Math.min(h.y,a.height),a.width,a.height):(e.style.top=d.clientY-h.y+"px",void(e.style.left=d.clientX-h.x+"px"))}}}()}var Ut=Ke,zt=$e,Wt=Qe,Jt=Ve;function Zt(e){this.name=e,this.values=[],this._value=0,this._color="#"+(16777215*Math.random()|0).toString(16)}S=new function(e){var t=new He,n=new Pt,r=n.get("layers"),o=r.value;window._data=n;var i=new Fe(t),a=new Mt(n,t),s=new vt(n,t);setTimeout((function(){i.save(new Re(n,"Loaded"),!0)})),t.on("keyframe",(function(e,t){o.indexOf(e);var r=n.get("ui:currentTime").value,a=tt(e,r);"number"==typeof a?(e.values.splice(a,0,{time:r,value:t,_color:"#"+(16777215*Math.random()|0).toString(16)}),i.save(new Re(n,"Add Keyframe"))):(console.log("remove from index",a),e.values.splice(a.index,1),i.save(new Re(n,"Remove Keyframe"))),y()})),t.on("keyframe.move",(function(e,t){i.save(new Re(n,"Move Keyframe"))})),t.on("value.change",(function(e,t,r){if(!e._mute){var o=n.get("ui:currentTime").value,a=tt(e,o);"number"==typeof a?(e.values.splice(a,0,{time:o,value:t,_color:"#"+(16777215*Math.random()|0).toString(16)}),r||i.save(new Re(n,"Add value"))):(a.object.value=t,r||i.save(new Re(n,"Update value"))),y()}})),t.on("action:solo",(function(e,t){e._solo=t,console.log(e,t)})),t.on("action:mute",(function(e,t){e._mute=t})),t.on("ease",(function(e,t){var r=n.get("ui:currentTime").value,o=nt(e,r);o&&o.entry&&(o.entry.tween=t),i.save(new Re(n,"Add Ease")),y()}));var l=null;function c(){le(),l=performance.now()-1e3*n.get("ui:currentTime").value,s.setControlStatus(!0)}function u(){oe(),l=null,s.setControlStatus(!1)}t.on("controls.toggle_play",(function(){l?u():c()})),t.on("controls.restart_play",(function(){l||c(),h(0)})),t.on("controls.play",c),t.on("controls.pause",u),t.on("controls.stop",(function(){null!==l&&u(),h(0)}));var d=n.get("ui:currentTime");function h(e){e=Math.max(0,e),d.value=e,l&&(l=performance.now()-1e3*e),y()}function f(e){e||(e="autosave");var r=n.getJSONString();try{localStorage[Jt+e]=r,t.fire("save:done")}catch(t){console.log("Cannot save",e,r)}}function v(e){e||(e=n.get("name").value),(e=prompt("Pick a name to save to (localStorage)",e))&&(n.data.name=e,f(e))}function p(e){g(JSON.parse(e))}function g(e){n.setJSON(e),void 0===n.getValue("ui")&&n.setValue("ui",{currentTime:0,totalTime:Ze.default_length,scrollTime:0,timeScale:Ze.time_scale}),i.clear(),i.save(new Re(n,"Loaded"),!0),m()}function m(){o=r.value,s.setState(r),a.setState(r),y()}function y(){var e=o.length*Ze.LINE_HEIGHT;k.setLength(Ze.TIMELINE_SCROLL_HEIGHT/e),s.repaint(),a.repaint()}function C(e){e&&p(localStorage[Jt+e])}t.on("time.update",h),t.on("totalTime.update",(function(e){})),t.on("update.scrollTime",(function(e){e=Math.max(0,e),n.get("ui:scrollTime").value=e,y()})),t.on("target.notify",(function(t,n){e&&(e[t]=n)})),t.on("update.scale",(function(e){console.log("range",e),n.get("ui:timeScale").value=e,a.repaint()})),t.on("controls.undo",(function(){var e=i.undo();n.setJSONString(e.state),m()})),t.on("controls.redo",(function(){var e=i.redo();n.setJSONString(e.state),m()})),function e(){if(requestAnimationFrame(e),l){var r=(performance.now()-l)/1e3;h(r),r>n.get("ui:totalTime").value&&(l=performance.now())}var o,i;T&&(w.style.width=Ze.width+"px",w.style.height=Ze.height+"px",o=s.dom,i=a.dom,o.style.cssText="position: absolute; left: 0px; top: 0px; height: "+Ze.height+"px;",Ut(o,{overflow:"hidden"}),o.style.width=Ze.LEFT_PANE_WIDTH+"px",i.style.position="absolute",i.style.top="0px",i.style.left=Ze.LEFT_PANE_WIDTH+"px",a.resize(),y(),T=!1,t.fire("resize")),a._paint()}(),this.openLocalSave=C,t.on("import",function(){var e;(e=prompt("Paste JSON in here to Load"))&&(console.log("Loading.. ",e),p(e))}.bind(this)),t.on("new",(function(){n.blank(),m()})),t.on("openfile",(function(){Wt((function(e){p(e)}),w)})),t.on("open",C),t.on("export",(function(){var e=n.getJSONString(),t=prompt("Hit OK to download otherwise Copy and Paste JSON",e);console.log(JSON.stringify(n.data,null,"\t")),t&&(e=n.getJSONString("\t"),zt(e,"timeliner-test.json"))})),t.on("save",(function(){var e=n.get("name").value;e?f(e):v(e)})),t.on("save_as",v),this.save=f,this.load=g;var w=document.createElement("div");Ut(w,{textAlign:"left",lineHeight:"1em",position:"absolute",top:"22px"});var L=document.createElement("div");Ut(L,{position:"fixed",top:"20px",left:"20px",margin:0,border:"1px solid "+Ue,padding:0,overflow:"hidden",backgroundColor:Ue,color:Je,zIndex:0,fontFamily:"monospace",fontSize:"12px"});var b=document.createElement("div"),x={position:"absolute",width:"100%",height:"22px",lineHeight:"22px",bottom:"0",background:Ue,fontSize:"11px"};Ut(b,x,{borderTop:"1px solid "+ze}),L.appendChild(w),L.appendChild(b);var S=document.createElement("span");S.textContent="hello!",S.style.marginLeft="10px",this.setStatus=function(e){S.textContent=e},t.on("state:save",(function(e){t.fire("status",e),f("autosave")})),t.on("status",this.setStatus);var _=document.createElement("div");Ut(_,x,{textAlign:"right"}),b.appendChild(S),b.appendChild(_);var E=document.createElement("div");E.id="ghostpane",Ut(E,{opacity:.2,position:"fixed",margin:0,padding:0,zIndex:-1,transitionProperty:"top, left, width, height, opacity",transitionDuration:"0.25s",transitionTimingFunction:"ease-in-out"});var M=document.createElement("timeliner");document.body.insertBefore(M,document.body.firstElementChild),M.appendChild(L),M.appendChild(E),w.appendChild(s.dom),w.appendChild(a.dom);var k=new qt(200,10);w.appendChild(k.dom),k.onScroll.do((function(e,t){"scrollto"===e&&(s.scrollTo(t),a.scrollTo(t))})),this.hide=function(){M.style.display="none"},this.show=function(){M.style.display="block"};var T=!0;this.addLayer=function(e){var t=new Zt(e);(o=r.value).push(t),s.setState(r)},this.dispose=function(){var e=L.parentElement;e.removeChild(L),e.removeChild(E)},this.setTarget=function(t){e=t},this.getValues=function(e,t){t=t||.15,e=e||2;for(var r=n.get("ui:currentTime").value,i=[],a=-e;a<=e;a++){for(var s={},l=0;l<o.length;l++){var c=o[l],u=nt(c,r+a*t);s[c.name]=u.value}i.push(s)}return i};var q=new jt(L,E);console.log("widget:",q),q.allowMove(!1),q.resizes.do((function(e,t){e-=4,t-=44,Ze.width=e-Ze.LEFT_PANE_WIDTH,Ze.height=t,Ze.TIMELINE_SCROLL_HEIGHT=t-Ze.MARKER_TRACK_HEIGHT;var n=Ze.TIMELINE_SCROLL_HEIGHT;k.setHeight(n-2),Ut(k.dom,{top:Ze.MARKER_TRACK_HEIGHT+"px",left:e-16+"px"}),T=!0}))}({x:0,y:0,rotate:0}),console.log(S),S.hide(),onRuntime=function(){console.log("Initialized"),fetch("/api/load").then((function(e){return e.json()})).then((function(e){return function(e){e.hasOwnProperty("order")&&(k=function(e){var t=new Uint8Array(Te(e)),n=Module._malloc(t.length+1);Module.HEAPU8.set(t,n);var r=Module._decodeText(n,t.length);Module._free(n);var o=[];if(null!=r){var i=UTF8ToString(r);Module._free(r);try{o=JSON.parse(i),M=i}catch(e){}}return o}(e.order)),function(e){T=te("settings",P=e),J()}(e.settings),function(e){var t=1;_=new Array(k.length).fill(null),E=new Map;for(var n=0;n<e.length;n++){var r=e[n];if(r.hasOwnProperty("id")&&r.hasOwnProperty("data")){E.set(r.id,r.data);var o=new Uint8Array(Te(r.data)),i=Module._malloc(o.length+1);Module.HEAPU8.set(o,i);var a=Module._inflateJSON(0,i,o.length);Module._free(i);var s=!1;if(null!=a){var l=UTF8ToString(a);Module._free(a);try{var c=JSON.parse(l),u=k.indexOf(c.seqID);-1==u?_.push(c):_[u]=c}catch(e){s=!0}}else s=!0;if(s){alert("Failed to decode sequence: "+r.id);var d={seqID:r.id,seqNam:"Corrupt Sequence #"+(t+1),seqframes:[{frdur:50,frnam:"1",frbeg:"",frend:""}]},h=k.indexOf(d.seqID);-1==h?_.push(d):_[h]=d,t+=1}}else console.log("not decoding")}0==(_=_.filter((function(e){return null!==e}))).length&&Ce(),$(0),Z(),B(),de()}(e.seq),e.hasOwnProperty("virtuoso")&&function(e,t){var n=new Uint8Array(Te(t)),r=Module._malloc(n.length+1);Module.HEAPU8.set(n,r);var o=Module._decodeText(r,n.length);Module._free(r),null!=o&&(e.setValue(UTF8ToString(o)),e.session.setUndoManager(new ace.UndoManager),Module._free(o))}(v,e.virtuoso)}(e)})).catch((function(e){console.log("Failed to load data from board:",e)}))}})();</script><script src="virtuoso.js" charset="utf-8"></script><script>Module['onRuntimeInitialized']=onRuntime;;</script></body></html>